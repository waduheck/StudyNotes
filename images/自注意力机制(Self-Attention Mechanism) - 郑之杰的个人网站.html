<!DOCTYPE html>
<!-- saved from url=(0058)https://0809zheng.github.io/2020/04/24/self-attention.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/gitalk.css">
<script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/hm.js"></script><script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/gitalk.min.js"></script>

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站</title>
    <meta name="author" content="郑之杰">
    <meta name="description" content="自注意力机制(Self-Attention Mechanism)">
    <meta name="keywords" content="深度学习">
    <!-- Open Graph -->
    <meta property="og:title" content="自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/2020/04/24/self-attention.html">
    <meta property="og:description" content="为天地立心, 为生民立命, 为往圣继绝学, 为万世开太平">
    <meta property="og:site_name" content="郑之杰的个人网站">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/normalize.min.css">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/github-markdown.css">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/prism.css">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/share.min.css">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/app.min.css">
    <link rel="stylesheet" href="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/font-awesome.min.css">
    <script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/jquery.min.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async="" src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/MathJax.js"></script>
	
    <script type="text/x-mathjax-config;executed=true">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
			displayMath: [ ["$$", "$$"], ["\\[","\\]"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>


	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
	
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?671e6ffb306c963dfa227c8335045b4f";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
		
        })();
    </script>

<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.mjx-chtml {display: inline-block; line-height: 0; text-indent: 0; text-align: left; text-transform: none; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; letter-spacing: normal; word-wrap: normal; word-spacing: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; margin: 0; padding: 1px 0}
.MJXc-display {display: block; text-align: center; margin: 1em 0; padding: 0}
.mjx-chtml[tabindex]:focus, body :focus .mjx-chtml[tabindex] {display: inline-table}
.mjx-full-width {text-align: center; display: table-cell!important; width: 10000em}
.mjx-math {display: inline-block; border-collapse: separate; border-spacing: 0}
.mjx-math * {display: inline-block; -webkit-box-sizing: content-box!important; -moz-box-sizing: content-box!important; box-sizing: content-box!important; text-align: left}
.mjx-numerator {display: block; text-align: center}
.mjx-denominator {display: block; text-align: center}
.MJXc-stacked {height: 0; position: relative}
.MJXc-stacked > * {position: absolute}
.MJXc-bevelled > * {display: inline-block}
.mjx-stack {display: inline-block}
.mjx-op {display: block}
.mjx-under {display: table-cell}
.mjx-over {display: block}
.mjx-over > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-under > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-stack > .mjx-sup {display: block}
.mjx-stack > .mjx-sub {display: block}
.mjx-prestack > .mjx-presup {display: block}
.mjx-prestack > .mjx-presub {display: block}
.mjx-delim-h > .mjx-char {display: inline-block}
.mjx-surd {vertical-align: top}
.mjx-mphantom * {visibility: hidden}
.mjx-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 2px 3px; font-style: normal; font-size: 90%}
.mjx-annotation-xml {line-height: normal}
.mjx-menclose > svg {fill: none; stroke: currentColor}
.mjx-mtr {display: table-row}
.mjx-mlabeledtr {display: table-row}
.mjx-mtd {display: table-cell; text-align: center}
.mjx-label {display: table-row}
.mjx-box {display: inline-block}
.mjx-block {display: block}
.mjx-span {display: inline}
.mjx-char {display: block; white-space: pre}
.mjx-itable {display: inline-table; width: auto}
.mjx-row {display: table-row}
.mjx-cell {display: table-cell}
.mjx-table {display: table; width: 100%}
.mjx-line {display: block; height: 0}
.mjx-strut {width: 0; padding-top: 1em}
.mjx-vsize {width: 0}
.MJXc-space1 {margin-left: .167em}
.MJXc-space2 {margin-left: .222em}
.MJXc-space3 {margin-left: .278em}
.mjx-chartest {display: block; visibility: hidden; position: absolute; top: 0; line-height: normal; font-size: 500%}
.mjx-chartest .mjx-char {display: inline}
.mjx-chartest .mjx-box {padding-top: 1000px}
.MJXc-processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MJXc-processed {display: none}
.mjx-test {display: block; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.mjx-ex-box-test {position: absolute; overflow: hidden; width: 1px; height: 60ex}
.mjx-line-box-test {display: table!important}
.mjx-line-box-test span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
#MathJax_CHTML_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.mjx-chtml .mjx-noError {line-height: 1.2; vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
.MJXc-TeX-unknown-R {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: normal}
.MJXc-TeX-unknown-I {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: normal}
.MJXc-TeX-unknown-B {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: bold}
.MJXc-TeX-unknown-BI {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: bold}
.MJXc-TeX-ams-R {font-family: MJXc-TeX-ams-R,MJXc-TeX-ams-Rw}
.MJXc-TeX-cal-B {font-family: MJXc-TeX-cal-B,MJXc-TeX-cal-Bx,MJXc-TeX-cal-Bw}
.MJXc-TeX-frak-R {font-family: MJXc-TeX-frak-R,MJXc-TeX-frak-Rw}
.MJXc-TeX-frak-B {font-family: MJXc-TeX-frak-B,MJXc-TeX-frak-Bx,MJXc-TeX-frak-Bw}
.MJXc-TeX-math-BI {font-family: MJXc-TeX-math-BI,MJXc-TeX-math-BIx,MJXc-TeX-math-BIw}
.MJXc-TeX-sans-R {font-family: MJXc-TeX-sans-R,MJXc-TeX-sans-Rw}
.MJXc-TeX-sans-B {font-family: MJXc-TeX-sans-B,MJXc-TeX-sans-Bx,MJXc-TeX-sans-Bw}
.MJXc-TeX-sans-I {font-family: MJXc-TeX-sans-I,MJXc-TeX-sans-Ix,MJXc-TeX-sans-Iw}
.MJXc-TeX-script-R {font-family: MJXc-TeX-script-R,MJXc-TeX-script-Rw}
.MJXc-TeX-type-R {font-family: MJXc-TeX-type-R,MJXc-TeX-type-Rw}
.MJXc-TeX-cal-R {font-family: MJXc-TeX-cal-R,MJXc-TeX-cal-Rw}
.MJXc-TeX-main-B {font-family: MJXc-TeX-main-B,MJXc-TeX-main-Bx,MJXc-TeX-main-Bw}
.MJXc-TeX-main-I {font-family: MJXc-TeX-main-I,MJXc-TeX-main-Ix,MJXc-TeX-main-Iw}
.MJXc-TeX-main-R {font-family: MJXc-TeX-main-R,MJXc-TeX-main-Rw}
.MJXc-TeX-math-I {font-family: MJXc-TeX-math-I,MJXc-TeX-math-Ix,MJXc-TeX-math-Iw}
.MJXc-TeX-size1-R {font-family: MJXc-TeX-size1-R,MJXc-TeX-size1-Rw}
.MJXc-TeX-size2-R {font-family: MJXc-TeX-size2-R,MJXc-TeX-size2-Rw}
.MJXc-TeX-size3-R {font-family: MJXc-TeX-size3-R,MJXc-TeX-size3-Rw}
.MJXc-TeX-size4-R {font-family: MJXc-TeX-size4-R,MJXc-TeX-size4-Rw}
.MJXc-TeX-vec-R {font-family: MJXc-TeX-vec-R,MJXc-TeX-vec-Rw}
.MJXc-TeX-vec-B {font-family: MJXc-TeX-vec-B,MJXc-TeX-vec-Bx,MJXc-TeX-vec-Bw}
@font-face {font-family: MJXc-TeX-ams-R; src: local('MathJax_AMS'), local('MathJax_AMS-Regular')}
@font-face {font-family: MJXc-TeX-ams-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_AMS-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-B; src: local('MathJax_Caligraphic Bold'), local('MathJax_Caligraphic-Bold')}
@font-face {font-family: MJXc-TeX-cal-Bx; src: local('MathJax_Caligraphic'); font-weight: bold}
@font-face {font-family: MJXc-TeX-cal-Bw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Bold.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Bold.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-R; src: local('MathJax_Fraktur'), local('MathJax_Fraktur-Regular')}
@font-face {font-family: MJXc-TeX-frak-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-B; src: local('MathJax_Fraktur Bold'), local('MathJax_Fraktur-Bold')}
@font-face {font-family: MJXc-TeX-frak-Bx; src: local('MathJax_Fraktur'); font-weight: bold}
@font-face {font-family: MJXc-TeX-frak-Bw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Bold.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Bold.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-BI; src: local('MathJax_Math BoldItalic'), local('MathJax_Math-BoldItalic')}
@font-face {font-family: MJXc-TeX-math-BIx; src: local('MathJax_Math'); font-weight: bold; font-style: italic}
@font-face {font-family: MJXc-TeX-math-BIw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Math-BoldItalic.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-R; src: local('MathJax_SansSerif'), local('MathJax_SansSerif-Regular')}
@font-face {font-family: MJXc-TeX-sans-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-B; src: local('MathJax_SansSerif Bold'), local('MathJax_SansSerif-Bold')}
@font-face {font-family: MJXc-TeX-sans-Bx; src: local('MathJax_SansSerif'); font-weight: bold}
@font-face {font-family: MJXc-TeX-sans-Bw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Bold.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Bold.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-I; src: local('MathJax_SansSerif Italic'), local('MathJax_SansSerif-Italic')}
@font-face {font-family: MJXc-TeX-sans-Ix; src: local('MathJax_SansSerif'); font-style: italic}
@font-face {font-family: MJXc-TeX-sans-Iw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Italic.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Italic.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-script-R; src: local('MathJax_Script'), local('MathJax_Script-Regular')}
@font-face {font-family: MJXc-TeX-script-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Script-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-type-R; src: local('MathJax_Typewriter'), local('MathJax_Typewriter-Regular')}
@font-face {font-family: MJXc-TeX-type-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Typewriter-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Typewriter-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Typewriter-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-R; src: local('MathJax_Caligraphic'), local('MathJax_Caligraphic-Regular')}
@font-face {font-family: MJXc-TeX-cal-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-B; src: local('MathJax_Main Bold'), local('MathJax_Main-Bold')}
@font-face {font-family: MJXc-TeX-main-Bx; src: local('MathJax_Main'); font-weight: bold}
@font-face {font-family: MJXc-TeX-main-Bw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Main-Bold.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-I; src: local('MathJax_Main Italic'), local('MathJax_Main-Italic')}
@font-face {font-family: MJXc-TeX-main-Ix; src: local('MathJax_Main'); font-style: italic}
@font-face {font-family: MJXc-TeX-main-Iw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Main-Italic.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-R; src: local('MathJax_Main'), local('MathJax_Main-Regular')}
@font-face {font-family: MJXc-TeX-main-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Main-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-I; src: local('MathJax_Math Italic'), local('MathJax_Math-Italic')}
@font-face {font-family: MJXc-TeX-math-Ix; src: local('MathJax_Math'); font-style: italic}
@font-face {font-family: MJXc-TeX-math-Iw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Math-Italic.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size1-R; src: local('MathJax_Size1'), local('MathJax_Size1-Regular')}
@font-face {font-family: MJXc-TeX-size1-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size1-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size2-R; src: local('MathJax_Size2'), local('MathJax_Size2-Regular')}
@font-face {font-family: MJXc-TeX-size2-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size2-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size3-R; src: local('MathJax_Size3'), local('MathJax_Size3-Regular')}
@font-face {font-family: MJXc-TeX-size3-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size3-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size4-R; src: local('MathJax_Size4'), local('MathJax_Size4-Regular')}
@font-face {font-family: MJXc-TeX-size4-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size4-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-R; src: local('MathJax_Vector'), local('MathJax_Vector-Regular')}
@font-face {font-family: MJXc-TeX-vec-Rw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Regular.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Regular.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-B; src: local('MathJax_Vector Bold'), local('MathJax_Vector-Bold')}
@font-face {font-family: MJXc-TeX-vec-Bx; src: local('MathJax_Vector'); font-weight: bold}
@font-face {font-family: MJXc-TeX-vec-Bw; src /*1*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Bold.eot'); src /*2*/: url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Bold.woff') format('woff'), url('https://cdn.bootcss.com/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Bold.otf') format('opentype')}
</style></head>


<body><div id="MathJax_Message" style="display: none;"></div>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="true"> <header class="g-header headerDown" style="background-color: transparent; box-shadow: none;">
    <div class="g-logo" style="background: url(&quot;/assets/icons/logo.svg&quot;) center center / 100% 100% no-repeat;">
      <a href="https://0809zheng.github.io/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="https://0809zheng.github.io/" style="color: rgb(255, 255, 255);">home</a></li>
            
            <li><a href="https://0809zheng.github.io/tags.html" style="color: rgb(255, 255, 255);">tags</a></li>
            
        </ul>
    </nav>
</header>


  <header class="g-banner post-header post-pattern-circuitBoard bgcolor-default " data-theme="default">
    <div class="post-wrapper">
      <div class="post-tags">
        
          
            <a href="https://0809zheng.github.io/tags.html#%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0" class="post-tag">深度学习</a>
          
        
      </div>
      <h1>自注意力机制(Self-Attention Mechanism)</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i>郑之杰</span>
        <time class="post-meta-item" datetime="20-04-24"><i class="iconfont icon-date"></i>24 Apr 2020</time>
      </div>
    </div>
    
    <div class="filter"></div>
      <div class="post-cover" style="background: url(&#39;https://pic.downk.cc/item/5ea28825c2a9a83be5477d93.jpg&#39;) center no-repeat; background-size: cover;"></div>
    
  </header>

  <div class="post-content visible">
    

    <article class="markdown-body">
      <blockquote>
  <p>Self-Attention Mechanism.</p>
</blockquote>

<p><strong>自注意力(Self-Attention)</strong>机制也称为<strong>内部注意力(Intra-Attention)</strong>，是一种特殊的<a href="https://0809zheng.github.io/2020/04/22/attention.html">注意力机制</a>。自注意力机制作为一种新型的网络结构被广泛应用于自然语言处理与计算机视觉等任务中。本文首先讨论注意力机制与自注意力机制的区别；其次对比卷积神经网络、循环神经网络和自注意力机制；最后介绍自注意力机制的实现细节。</p>

<p><strong>本文目录</strong>：</p>
<ol>
  <li>Attention and Self-Attention</li>
  <li>CNN, RNN, and Self-Attention</li>
  <li>Self-Attention</li>
  <li>Multi-Head Self-Attention</li>
  <li>Position Encoding</li>
</ol>

<h1 id="1-attention-and-self-attention">1. Attention and Self-Attention<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#1-attention-and-self-attention"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h1>
<p><a href="https://0809zheng.github.io/2020/04/22/attention.html">注意力机制</a>(<strong>attention mechanism</strong>)最早是在序列到序列模型中提出的，用于解决机器翻译任务。在该任务中需要把输入序列<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-1-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-1" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-2" class="mjx-mrow"><span id="MJXc-Node-3" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">{</span></span><span id="MJXc-Node-4" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-5" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-6" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-7" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-8" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-9" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-10" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span></span></span><span id="MJXc-Node-11" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-12" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-13" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-14" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-15" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-16" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-17" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-18" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span><span id="MJXc-Node-19" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">}</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>j</mi></msub><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">\{x_1,x_2,...,x_j\}</script>转换为输出序列<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-2-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-20" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-21" class="mjx-mrow"><span id="MJXc-Node-22" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">{</span></span><span id="MJXc-Node-23" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-24" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.481em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-25" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-26" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-27" class="mjx-msubsup MJXc-space1"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-28" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.481em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-29" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span></span></span><span id="MJXc-Node-30" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-31" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-32" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-33" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-34" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-35" class="mjx-msubsup MJXc-space1"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-36" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.481em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-37" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span><span id="MJXc-Node-38" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">}</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">\{y_1,y_2,...,y_i\}</script>，因此序列到序列模型采用编码器-解码器结构，即引入可学习的权重参数<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-3-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-39" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-40" class="mjx-mrow"><span id="MJXc-Node-41" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-42" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">w</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-43" class="mjx-texatom" style=""><span id="MJXc-Node-44" class="mjx-mrow"><span id="MJXc-Node-45" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span><span id="MJXc-Node-46" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3">w_{ij}</script>，使得：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-4-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-47" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-48" class="mjx-mrow"><span id="MJXc-Node-49" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-50" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-51" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span><span id="MJXc-Node-52" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-53" class="mjx-munderover MJXc-space3"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.283em; padding-top: 0.141em; padding-left: 1.021em;"><span id="MJXc-Node-58" class="mjx-texatom" style=""><span id="MJXc-Node-59" class="mjx-mrow"></span></span></span><span class="mjx-op"><span id="MJXc-Node-54" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.714em; padding-bottom: 0.714em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.815em;"><span id="MJXc-Node-55" class="mjx-texatom" style=""><span id="MJXc-Node-56" class="mjx-mrow"><span id="MJXc-Node-57" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">j</span></span></span></span></span></span></span></span><span id="MJXc-Node-60" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-61" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">w</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-62" class="mjx-texatom" style=""><span id="MJXc-Node-63" class="mjx-mrow"><span id="MJXc-Node-64" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-65" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">j</span></span></span></span></span></span><span id="MJXc-Node-66" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-67" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-68" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">j</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi></mrow><mrow class="MJX-TeXAtom-ORD"></mrow></munderover><msub><mi>w</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>x</mi><mi>j</mi></msub></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-4">y_i = \sum_{j}^{}w_{ij}x_j</script>

<p>其中<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-5-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-69" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-70" class="mjx-mrow"><span id="MJXc-Node-71" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-72" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">w</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-73" class="mjx-texatom" style=""><span id="MJXc-Node-74" class="mjx-mrow"><span id="MJXc-Node-75" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span><span id="MJXc-Node-76" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-5">w_{ij}</script>表示输入序列的第<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-6-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-77" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-78" class="mjx-mrow"><span id="MJXc-Node-79" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">i</script>个<strong>token</strong>对输出序列的第<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-7-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-80" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-81" class="mjx-mrow"><span id="MJXc-Node-82" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">j</script>个<strong>token</strong>的重要性程度。在实际中引入约束<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-8-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-83" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-84" class="mjx-mrow"><span id="MJXc-Node-85" class="mjx-munderover"><span class="mjx-base"><span id="MJXc-Node-86" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.528em; padding-bottom: 0.528em;">∑</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.439em; padding-right: 0.071em;"><span id="MJXc-Node-87" class="mjx-texatom" style=""><span id="MJXc-Node-88" class="mjx-mrow"><span id="MJXc-Node-89" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span></span></span><span id="MJXc-Node-92" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-93" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">w</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-94" class="mjx-texatom" style=""><span id="MJXc-Node-95" class="mjx-mrow"><span id="MJXc-Node-96" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span><span id="MJXc-Node-97" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span></span></span><span id="MJXc-Node-98" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.098em; padding-bottom: 0.337em;">=</span></span><span id="MJXc-Node-99" class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi></mrow><mrow class="MJX-TeXAtom-ORD"></mrow></munderover><msub><mi>w</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-8">\sum_{j}^{}w_{ij}=1</script>，这一步是通过<strong>softmax</strong>函数实现的。自注意力机制是一种特殊的注意力机制，其主要区别在于前者的权重参数<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-9-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-100" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-101" class="mjx-mrow"><span id="MJXc-Node-102" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-103" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">w</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-104" class="mjx-texatom" style=""><span id="MJXc-Node-105" class="mjx-mrow"><span id="MJXc-Node-106" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span><span id="MJXc-Node-107" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.481em;">j</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-9">w_{ij}</script>并不是直接学习得到的，而是由输入计算得到的，如通过<strong>点积</strong>的方式计算两个输入<strong>token</strong>的相关性：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-10-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-108" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-109" class="mjx-mrow"><span id="MJXc-Node-110" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-111" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">w</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-112" class="mjx-texatom" style=""><span id="MJXc-Node-113" class="mjx-mrow"><span id="MJXc-Node-114" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-115" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">j</span></span></span></span></span></span><span id="MJXc-Node-116" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-117" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-118" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-120" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.12em;">T</span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-119" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span></span><span id="MJXc-Node-121" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-122" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-123" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">j</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>w</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msubsup><mi>x</mi><mi>i</mi><mi>T</mi></msubsup><msub><mi>x</mi><mi>j</mi></msub></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-10">w_{ij}=x_i^Tx_j</script>

<p>注意力机制与自注意力机制的主要区别包括：</p>
<ol>
  <li>注意力机制的权重参数是一个全局可学习参数，对于模型来说是<strong>固定</strong>的；而自注意力机制的权重参数是由输入决定的，即使是同一个模型，对于不同的输入也会有<strong>不同</strong>的权重参数。</li>
  <li>注意力机制的输出序列长度与输入序列长度可以是<strong>不同</strong>的；而自注意力机制的的输出序列长度与输入序列长度必须是<strong>相同</strong>的。</li>
  <li>注意力机制在一个模型中通常只使用一次，作为编码器和解码器之间的<strong>连接</strong>部分；而自注意力机制在同一个模型中可以使用很多次，作为网络<strong>结构</strong>的一部分。</li>
  <li>注意力机制擅长捕捉两个<strong>序列之间</strong>的关系，如机器翻译任务中将一个序列映射为另一个序列；而自注意力机制擅长捕捉单个<strong>序列内部</strong>的关系，如作为预训练语言模型的基本结构。</li>
</ol>

<h1 id="2-cnn-rnn-and-self-attention">2. CNN, RNN, and Self-Attention<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#2-cnn-rnn-and-self-attention"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h1>
<p>卷积神经网络、循环神经网络和自注意力机制都可以用于自然语言处理任务。在自然语言处理任务中，首先对输入序列(如句子)进行分词，将每个词转化成对应的词向量；即可将输入序列表示为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-11-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-124" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-125" class="mjx-mrow"><span id="MJXc-Node-126" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.024em;">X</span></span><span id="MJXc-Node-127" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.098em; padding-bottom: 0.337em;">=</span></span><span id="MJXc-Node-128" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">(</span></span><span id="MJXc-Node-129" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-130" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-131" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-132" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-133" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-134" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-135" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span></span></span><span id="MJXc-Node-136" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-137" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">…</span></span><span id="MJXc-Node-138" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-139" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-140" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-141" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">n</span></span></span></span><span id="MJXc-Node-142" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">)</span></span><span id="MJXc-Node-143" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.242em; padding-bottom: 0.385em;">∈</span></span><span id="MJXc-Node-144" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-145" class="mjx-texatom"><span id="MJXc-Node-146" class="mjx-mrow"><span id="MJXc-Node-147" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.433em; padding-bottom: 0.289em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-148" class="mjx-texatom" style=""><span id="MJXc-Node-149" class="mjx-mrow"><span id="MJXc-Node-150" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">n</span></span><span id="MJXc-Node-151" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.194em; padding-bottom: 0.337em;">×</span></span><span id="MJXc-Node-152" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.003em;">d</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>…</mo><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mo>×</mo><mi>d</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-11">X=(x_1,x_2,…,x_n)\in \Bbb{R}^{n \times d}</script>，其中<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-12-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-153" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-154" class="mjx-mrow"><span id="MJXc-Node-155" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-156" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-157" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-12">x_i</script>表示第<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-13-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-158" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-159" class="mjx-mrow"><span id="MJXc-Node-160" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">i</script>个词的维度为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-14-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-161" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-162" class="mjx-mrow"><span id="MJXc-Node-163" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.003em;">d</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">d</script>的词向量。因此对输入序列的处理等价于对该序列进行编码：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/60ebc1765132923bf88a64f9.jpg" alt=""></p>

<h3 id="a-卷积神经网络">(a) 卷积神经网络<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#a-%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p>可以用(<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-15-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-164" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-165" class="mjx-mrow"><span id="MJXc-Node-166" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-15">1</script>维)<strong>卷积神经网络</strong>对该输入序列进行处理。即使用卷积核进行滑动窗口遍历，如长度为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-16-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-167" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-168" class="mjx-mrow"><span id="MJXc-Node-169" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.385em;">3</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn></math></span></span><script type="math/tex" id="MathJax-Element-16">3</script>的卷积核：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-17-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-170" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-171" class="mjx-mrow"><span id="MJXc-Node-172" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-173" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-174" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span><span id="MJXc-Node-175" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-176" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.06em;">f</span></span><span id="MJXc-Node-177" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-178" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-179" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-180" class="mjx-texatom" style=""><span id="MJXc-Node-181" class="mjx-mrow"><span id="MJXc-Node-182" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-183" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">−</span></span><span id="MJXc-Node-184" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span></span></span><span id="MJXc-Node-185" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-186" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-187" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-188" class="mjx-texatom" style=""><span id="MJXc-Node-189" class="mjx-mrow"><span id="MJXc-Node-190" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span></span></span><span id="MJXc-Node-191" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-192" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-193" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-194" class="mjx-texatom" style=""><span id="MJXc-Node-195" class="mjx-mrow"><span id="MJXc-Node-196" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-197" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">+</span></span><span id="MJXc-Node-198" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span></span></span><span id="MJXc-Node-199" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-17">y_i = f(x_{i-1},x_{i},x_{i+1})</script>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea28dafc2a9a83be54e9e5c.jpg" alt=""></p>

<p>卷积神经网络容易并行，可以捕捉一些全局的结构信息。但其<strong>弊端</strong>是每一个卷积核只能感受局部的信息，要获得更大的<strong>receptive field</strong>需要加深层数。</p>

<h3 id="b-循环神经网络">(b) 循环神经网络<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#b-%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>

<p><strong>循环神经网络</strong>是自然语言处理任务中最常用的模型，其计算过程是通过递归实现的：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-18-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-200" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-201" class="mjx-mrow"><span id="MJXc-Node-202" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-203" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-204" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span><span id="MJXc-Node-205" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-206" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.06em;">f</span></span><span id="MJXc-Node-207" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-208" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-209" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">h</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-210" class="mjx-texatom" style=""><span id="MJXc-Node-211" class="mjx-mrow"><span id="MJXc-Node-212" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-213" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">−</span></span><span id="MJXc-Node-214" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span></span></span><span id="MJXc-Node-215" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-216" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-217" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-218" class="mjx-texatom" style=""><span id="MJXc-Node-219" class="mjx-mrow"><span id="MJXc-Node-220" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span></span></span><span id="MJXc-Node-221" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>h</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-18">y_i = f(h_{i-1},x_{i})</script>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea28d62c2a9a83be54e2d83.jpg" alt=""></p>

<p>循环神经网络本身结构简单，适合序列建模。但其<strong>弊端</strong>是对于输入序列是顺序处理的，速度较慢，不能并行(<strong>parallel</strong>)实现；且循环神经网络无法很好的学习到全局结构信息(尽管上图的双向结构一定程度上缓解了这个问题)。</p>

<h3 id="c-自注意力">(c) 自注意力<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#c-%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p><strong>自注意力模型</strong>的每个输出基于<strong>全局信息</strong>，并且可以<strong>并行化</strong>计算：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-19-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-222" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-223" class="mjx-mrow"><span id="MJXc-Node-224" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-225" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-226" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span><span id="MJXc-Node-227" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-228" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.06em;">f</span></span><span id="MJXc-Node-229" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-230" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-231" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-232" class="mjx-texatom" style=""><span id="MJXc-Node-233" class="mjx-mrow"><span id="MJXc-Node-234" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span></span></span><span id="MJXc-Node-235" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-236" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-237" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-238" class="mjx-texatom" style=""><span id="MJXc-Node-239" class="mjx-mrow"><span id="MJXc-Node-240" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span></span></span></span></span><span id="MJXc-Node-241" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-242" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-243" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-244" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-245" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-246" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-247" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-248" class="mjx-texatom" style=""><span id="MJXc-Node-249" class="mjx-mrow"><span id="MJXc-Node-250" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span></span></span></span></span><span id="MJXc-Node-251" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-19">y_i = f(x_{1},x_{2},...,x_{n})</script>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea28e2bc2a9a83be54f42d5.jpg" alt=""></p>

<h3 id="d-对不同网络结构的讨论">(d) 对不同网络结构的讨论<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#d-%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E7%9A%84%E8%AE%A8%E8%AE%BA"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>

<ol>
  <li>卷积神经网络事实上只能获得局部信息，需要通过<strong>堆叠</strong>更多层数来增大感受野；循环神经网络需要通过<strong>递归</strong>获得全局信息，因此一般采用双向形式；自注意力机制能够直接获得<strong>全局信息</strong>。</li>
  <li>常用的神经网络模型(如多层感知机)，其每一层的权重参数经过训练后是<strong>固定</strong>的，与输入无关；而自注意力层的权重是由输入决定的，但其只能处理长度固定的输入序列。</li>
  <li>循环神经网络是递归计算的，无法并行；卷积神经网络的不同卷积核之间可以并行计算；自注意力机制的计算是高度并行的，很容易被<strong>GPU</strong>等加速。</li>
</ol>

<p>若输入序列长度为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-20-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-252" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-253" class="mjx-mrow"><span id="MJXc-Node-254" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">n</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">n</script>，特征维度为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-21-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-255" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-256" class="mjx-mrow"><span id="MJXc-Node-257" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.003em;">d</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">d</script>。则上述模型每层的计算复杂度、序列操作数(越大表示可并行化程度越差)和最大路径长度分别为：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-22-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;center center center center&quot; rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot; rowlines=&quot;solid none&quot; columnlines=&quot;solid none none&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;Layer Type&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;Complexity per Layer&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;Sequential Operations&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;Maximum Path Length&lt;/mtext&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;Convolutional&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;Recurrent&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;Self-Attention&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-258" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-259" class="mjx-mrow"><span id="MJXc-Node-260" class="mjx-mtable" style="vertical-align: -2.785em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-261" class="mjx-mtr" style="height: 1.452em;"><span id="MJXc-Node-262" class="mjx-mtd" style="border-right: 1.3px solid; padding: 0.221em 0.475em 0px 0.4em; border-bottom: 1.3px solid; width: 6.168em;"><span id="MJXc-Node-263" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-264" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.561em;">Layer Type</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-265" class="mjx-mtd" style="padding: 0.221em 0.5em 0px 0.475em; border-bottom: 1.3px solid; width: 9.437em;"><span id="MJXc-Node-266" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-267" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.561em;">Complexity per Layer</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-268" class="mjx-mtd" style="padding: 0.221em 0.5em 0px; border-bottom: 1.3px solid; width: 9.566em;"><span id="MJXc-Node-269" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-270" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.511em;">Sequential Operations</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-271" class="mjx-mtd" style="padding: 0.221em 0.4em 0px 0.5em; border-bottom: 1.3px solid; width: 10.141em;"><span id="MJXc-Node-272" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-273" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.561em;">Maximum Path Length</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-274" class="mjx-mtr" style="height: 1.543em;"><span id="MJXc-Node-275" class="mjx-mtd" style="border-right: 1.3px solid; padding: 0.2em 0.475em 0px 0.4em;"><span id="MJXc-Node-276" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-277" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.358em;">Convolutional</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-278" class="mjx-mtd" style="padding: 0.2em 0.5em 0px 0.475em;"><span id="MJXc-Node-279" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-280" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-281" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-282" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span><span id="MJXc-Node-283" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.307em;">⋅</span></span><span id="MJXc-Node-284" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-285" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.307em;">⋅</span></span><span id="MJXc-Node-286" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.003em;"><span id="MJXc-Node-287" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.003em;">d</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0.076em; padding-right: 0.071em;"><span id="MJXc-Node-288" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span></span></span><span id="MJXc-Node-289" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-290" class="mjx-mtd" style="padding: 0.2em 0.5em 0px;"><span id="MJXc-Node-291" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-292" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-293" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-294" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span><span id="MJXc-Node-295" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-296" class="mjx-mtd" style="padding: 0.2em 0.4em 0px 0.5em;"><span id="MJXc-Node-297" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-298" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-299" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-300" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-301" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.561em;">log</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.377em; padding-right: 0.071em;"><span id="MJXc-Node-302" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-303" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-304" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-305" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-306" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-307" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-308" class="mjx-mtr" style="height: 1.527em;"><span id="MJXc-Node-309" class="mjx-mtd" style="border-right: 1.3px solid; padding: 0.2em 0.475em 0px 0.4em;"><span id="MJXc-Node-310" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-311" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.358em;">Recurrent</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-312" class="mjx-mtd" style="padding: 0.2em 0.5em 0px 0.475em;"><span id="MJXc-Node-313" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-314" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-315" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-316" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-317" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.307em;">⋅</span></span><span id="MJXc-Node-318" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.003em;"><span id="MJXc-Node-319" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.003em;">d</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0.076em; padding-right: 0.071em;"><span id="MJXc-Node-320" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span></span></span><span id="MJXc-Node-321" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-322" class="mjx-mtd" style="padding: 0.2em 0.5em 0px;"><span id="MJXc-Node-323" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-324" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-325" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-326" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-327" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-328" class="mjx-mtd" style="padding: 0.2em 0.4em 0px 0.5em;"><span id="MJXc-Node-329" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-330" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-331" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-332" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-333" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-334" class="mjx-mtr" style="height: 1.548em;"><span id="MJXc-Node-335" class="mjx-mtd" style="border-right: 1.3px solid; padding: 0.2em 0.475em 0px 0.4em;"><span id="MJXc-Node-336" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-337" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.358em;">Self-Attention</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-338" class="mjx-mtd" style="padding: 0.2em 0.5em 0px 0.475em;"><span id="MJXc-Node-339" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-340" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-341" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-342" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-343" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-344" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span></span></span><span id="MJXc-Node-345" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.307em;">⋅</span></span><span id="MJXc-Node-346" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.003em;">d</span></span><span id="MJXc-Node-347" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-348" class="mjx-mtd" style="padding: 0.2em 0.5em 0px;"><span id="MJXc-Node-349" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-350" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-351" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-352" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span><span id="MJXc-Node-353" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-354" class="mjx-mtd" style="padding: 0.2em 0.4em 0px 0.5em;"><span id="MJXc-Node-355" class="mjx-mrow" style="margin-top: -0.148em;"><span id="MJXc-Node-356" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">O</span></span><span id="MJXc-Node-357" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-358" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span><span id="MJXc-Node-359" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="center center center center" rowspacing="4pt" columnspacing="1em" rowlines="solid none" columnlines="solid none none"><mtr><mtd><mtext>Layer Type</mtext></mtd><mtd><mtext>Complexity per Layer</mtext></mtd><mtd><mtext>Sequential Operations</mtext></mtd><mtd><mtext>Maximum Path Length</mtext></mtd></mtr><mtr><mtd><mtext>Convolutional</mtext></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mo>⋅</mo><mi>n</mi><mo>⋅</mo><msup><mi>d</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><msub><mi>log</mi><mi>k</mi></msub><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mtext>Recurrent</mtext></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo>⋅</mo><msup><mi>d</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mtext>Self-Attention</mtext></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>⋅</mo><mi>d</mi><mo stretchy="false">)</mo></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mtd><mtd><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mtd></mtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-22">\begin{array}{c|ccc}
    \text{Layer Type} & \text{Complexity per Layer} & \text{Sequential Operations} & \text{Maximum Path Length} \\
    \hline
    \text{Convolutional} & O(k \cdot n \cdot d^2) & O(1) & O(\log_k(n)) \\
    \text{Recurrent} & O(n \cdot d^2) & O(n) & O(n) \\
    \text{Self-Attention} & O(n^2 \cdot d) & O(1) & O(1) \\ 
\end{array}</script>

<h1 id="3-self-attention">3. Self-Attention<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#3-self-attention"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h1>
<p>本小节介绍自注意力机制的运算过程。自注意力模型采用<strong>查询-键-值(Query-Key-Value,QKV)</strong>模式。</p>

<h3 id="1-计算查询矩阵q键矩阵k值矩阵v">(1) 计算查询矩阵Q,键矩阵K,值矩阵V<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#1-%E8%AE%A1%E7%AE%97%E6%9F%A5%E8%AF%A2%E7%9F%A9%E9%98%B5q%E9%94%AE%E7%9F%A9%E9%98%B5k%E5%80%BC%E7%9F%A9%E9%98%B5v"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p>假设输入序列为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-23-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-360" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-361" class="mjx-mrow"><span id="MJXc-Node-362" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.024em;">X</span></span><span id="MJXc-Node-363" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.098em; padding-bottom: 0.337em;">=</span></span><span id="MJXc-Node-364" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">[</span></span><span id="MJXc-Node-365" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-366" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-367" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-368" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-369" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-370" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-371" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-372" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-373" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-374" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-375" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-376" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">]</span></span><span id="MJXc-Node-377" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.242em; padding-bottom: 0.385em;">∈</span></span><span id="MJXc-Node-378" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-379" class="mjx-texatom"><span id="MJXc-Node-380" class="mjx-mrow"><span id="MJXc-Node-381" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.433em; padding-bottom: 0.289em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-382" class="mjx-texatom" style=""><span id="MJXc-Node-383" class="mjx-mrow"><span id="MJXc-Node-384" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-385" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-386" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span></span><span id="MJXc-Node-387" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.194em; padding-bottom: 0.337em;">×</span></span><span id="MJXc-Node-388" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy="false">]</mo><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>x</mi></msub><mo>×</mo><mi>N</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-23">X=[x_1,...,x_N] \in \Bbb{R}^{D_x×N}</script>,经过<strong>词嵌入</strong>得到<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-24-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-389" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-390" class="mjx-mrow"><span id="MJXc-Node-391" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">A</span></span><span id="MJXc-Node-392" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.098em; padding-bottom: 0.337em;">=</span></span><span id="MJXc-Node-393" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">[</span></span><span id="MJXc-Node-394" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-395" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">a</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-396" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-397" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-398" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-399" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-400" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-401" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-402" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-403" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">a</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-404" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-405" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">]</span></span><span id="MJXc-Node-406" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.242em; padding-bottom: 0.385em;">∈</span></span><span id="MJXc-Node-407" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-408" class="mjx-texatom"><span id="MJXc-Node-409" class="mjx-mrow"><span id="MJXc-Node-410" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.433em; padding-bottom: 0.289em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-411" class="mjx-texatom" style=""><span id="MJXc-Node-412" class="mjx-mrow"><span id="MJXc-Node-413" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-414" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-415" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">a</span></span></span></span><span id="MJXc-Node-416" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.194em; padding-bottom: 0.337em;">×</span></span><span id="MJXc-Node-417" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>a</mi><mi>N</mi></msub><mo stretchy="false">]</mo><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>a</mi></msub><mo>×</mo><mi>N</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-24">A=[a_1,...,a_N] \in \Bbb{R}^{D_a×N}</script>;
将词嵌入矩阵线性映射到三个不同的空间，得到</p>
<ol>
  <li><strong>查询矩阵</strong><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-25-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-418" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-419" class="mjx-mrow"><span id="MJXc-Node-420" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">Q</span></span><span id="MJXc-Node-421" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-422" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">[</span></span><span id="MJXc-Node-423" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.014em;"><span id="MJXc-Node-424" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.014em;">q</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-425" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span><span id="MJXc-Node-426" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-427" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-428" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-429" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-430" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-431" class="mjx-msubsup MJXc-space1"><span class="mjx-base" style="margin-right: -0.014em;"><span id="MJXc-Node-432" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.014em;">q</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-433" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-434" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">]</span></span><span id="MJXc-Node-435" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.358em;">∈</span></span><span id="MJXc-Node-436" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-437" class="mjx-texatom"><span id="MJXc-Node-438" class="mjx-mrow"><span id="MJXc-Node-439" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.46em; padding-bottom: 0.307em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-440" class="mjx-texatom" style=""><span id="MJXc-Node-441" class="mjx-mrow"><span id="MJXc-Node-442" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-443" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-444" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-445" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.307em;">×</span></span><span id="MJXc-Node-446" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>q</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>q</mi><mi>N</mi></msub><mo stretchy="false">]</mo><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>k</mi></msub><mo>×</mo><mi>N</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-25">Q=[q_1,...,q_N] \in \Bbb{R}^{D_k×N}</script></li>
  <li><strong>键矩阵</strong><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-26-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-447" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-448" class="mjx-mrow"><span id="MJXc-Node-449" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.04em;">K</span></span><span id="MJXc-Node-450" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-451" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">[</span></span><span id="MJXc-Node-452" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-453" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-454" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span><span id="MJXc-Node-455" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-456" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-457" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-458" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-459" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-460" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-461" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-462" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-463" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">]</span></span><span id="MJXc-Node-464" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.358em;">∈</span></span><span id="MJXc-Node-465" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-466" class="mjx-texatom"><span id="MJXc-Node-467" class="mjx-mrow"><span id="MJXc-Node-468" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.46em; padding-bottom: 0.307em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-469" class="mjx-texatom" style=""><span id="MJXc-Node-470" class="mjx-mrow"><span id="MJXc-Node-471" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-472" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-473" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-474" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.307em;">×</span></span><span id="MJXc-Node-475" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>K</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>k</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>k</mi><mi>N</mi></msub><mo stretchy="false">]</mo><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>k</mi></msub><mo>×</mo><mi>N</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-26">K=[k_1,...,k_N] \in \Bbb{R}^{D_k×N}</script></li>
  <li><strong>值矩阵</strong><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-27-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-476" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-477" class="mjx-mrow"><span id="MJXc-Node-478" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.186em;">V</span></span><span id="MJXc-Node-479" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-480" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">[</span></span><span id="MJXc-Node-481" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-482" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">v</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-483" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span><span id="MJXc-Node-484" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-485" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-486" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-487" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-488" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-489" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-490" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">v</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-491" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-492" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">]</span></span><span id="MJXc-Node-493" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.358em;">∈</span></span><span id="MJXc-Node-494" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-495" class="mjx-texatom"><span id="MJXc-Node-496" class="mjx-mrow"><span id="MJXc-Node-497" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.46em; padding-bottom: 0.307em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-498" class="mjx-texatom" style=""><span id="MJXc-Node-499" class="mjx-mrow"><span id="MJXc-Node-500" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-501" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-502" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">v</span></span></span></span><span id="MJXc-Node-503" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.307em;">×</span></span><span id="MJXc-Node-504" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>v</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>v</mi><mi>N</mi></msub><mo stretchy="false">]</mo><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>v</mi></msub><mo>×</mo><mi>N</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-27">V=[v_1,...,v_N] \in \Bbb{R}^{D_v×N}</script>;</li>
</ol>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea2912ec2a9a83be5531a8a.jpg" alt=""></p>

<p>矩阵运算如下：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-28-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-505" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-506" class="mjx-mrow"><span id="MJXc-Node-507" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">Q</span></span><span id="MJXc-Node-508" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-509" class="mjx-msubsup MJXc-space3"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-510" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-511" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.014em;">q</span></span></span></span><span id="MJXc-Node-512" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span><span id="MJXc-Node-513" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-514" class="mjx-mspace" style="width: 1em; height: 0px;"></span><span id="MJXc-Node-515" class="mjx-msubsup MJXc-space1"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-516" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-517" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.46em; padding-right: 0.014em;">q</span></span></span></span><span id="MJXc-Node-518" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.358em;">∈</span></span><span id="MJXc-Node-519" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-520" class="mjx-texatom"><span id="MJXc-Node-521" class="mjx-mrow"><span id="MJXc-Node-522" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.46em; padding-bottom: 0.307em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-523" class="mjx-texatom" style=""><span id="MJXc-Node-524" class="mjx-mrow"><span id="MJXc-Node-525" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-526" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-527" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-528" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.307em;">×</span></span><span id="MJXc-Node-529" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-530" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-531" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">a</span></span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo>=</mo><msup><mi>W</mi><mi>q</mi></msup><mi>A</mi><mo>,</mo><mspace width="1em"></mspace><msup><mi>W</mi><mi>q</mi></msup><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>k</mi></msub><mo>×</mo><msub><mi>D</mi><mi>a</mi></msub></mrow></msup></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-28">Q = W^qA, \quad W^q \in \Bbb{R}^{D_k×D_a}</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-29-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-532" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-533" class="mjx-mrow"><span id="MJXc-Node-534" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.04em;">K</span></span><span id="MJXc-Node-535" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-536" class="mjx-msubsup MJXc-space3"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-537" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-538" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-539" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span><span id="MJXc-Node-540" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-541" class="mjx-mspace" style="width: 1em; height: 0px;"></span><span id="MJXc-Node-542" class="mjx-msubsup MJXc-space1"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-543" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-544" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-545" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.358em;">∈</span></span><span id="MJXc-Node-546" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-547" class="mjx-texatom"><span id="MJXc-Node-548" class="mjx-mrow"><span id="MJXc-Node-549" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.46em; padding-bottom: 0.307em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-550" class="mjx-texatom" style=""><span id="MJXc-Node-551" class="mjx-mrow"><span id="MJXc-Node-552" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-553" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-554" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span><span id="MJXc-Node-555" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.307em;">×</span></span><span id="MJXc-Node-556" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-557" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-558" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">a</span></span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>K</mi><mo>=</mo><msup><mi>W</mi><mi>k</mi></msup><mi>A</mi><mo>,</mo><mspace width="1em"></mspace><msup><mi>W</mi><mi>k</mi></msup><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>k</mi></msub><mo>×</mo><msub><mi>D</mi><mi>a</mi></msub></mrow></msup></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-29">K = W^kA, \quad W^k \in \Bbb{R}^{D_k×D_a}</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-30-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-559" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-560" class="mjx-mrow"><span id="MJXc-Node-561" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.186em;">V</span></span><span id="MJXc-Node-562" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-563" class="mjx-msubsup MJXc-space3"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-564" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-565" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">v</span></span></span></span><span id="MJXc-Node-566" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span><span id="MJXc-Node-567" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-568" class="mjx-mspace" style="width: 1em; height: 0px;"></span><span id="MJXc-Node-569" class="mjx-msubsup MJXc-space1"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-570" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-571" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">v</span></span></span></span><span id="MJXc-Node-572" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.358em;">∈</span></span><span id="MJXc-Node-573" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-574" class="mjx-texatom"><span id="MJXc-Node-575" class="mjx-mrow"><span id="MJXc-Node-576" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.46em; padding-bottom: 0.307em;">R</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.615em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-577" class="mjx-texatom" style=""><span id="MJXc-Node-578" class="mjx-mrow"><span id="MJXc-Node-579" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-580" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-581" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">v</span></span></span></span><span id="MJXc-Node-582" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.307em;">×</span></span><span id="MJXc-Node-583" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-584" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-585" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">a</span></span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>V</mi><mo>=</mo><msup><mi>W</mi><mi>v</mi></msup><mi>A</mi><mo>,</mo><mspace width="1em"></mspace><msup><mi>W</mi><mi>v</mi></msup><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>D</mi><mi>v</mi></msub><mo>×</mo><msub><mi>D</mi><mi>a</mi></msub></mrow></msup></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-30">V = W^vA, \quad W^v \in \Bbb{R}^{D_v×D_a}</script>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea2928ac2a9a83be554b900.jpg" alt=""></p>

<h3 id="2-计算注意力分布">(2) 计算注意力分布<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#2-%E8%AE%A1%E7%AE%97%E6%B3%A8%E6%84%8F%E5%8A%9B%E5%88%86%E5%B8%83"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p>对于每个查询向量<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-31-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-586" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-587" class="mjx-mrow"><span id="MJXc-Node-588" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.014em;"><span id="MJXc-Node-589" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.481em; padding-right: 0.014em;">q</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-590" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>q</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-31">q_i</script>使用<strong>键值对注意力机制</strong>,得到注意力分布<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-32-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-591" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-592" class="mjx-mrow"><span id="MJXc-Node-593" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-594" class="mjx-texatom"><span id="MJXc-Node-595" class="mjx-mrow"><span id="MJXc-Node-596" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.213em; padding-bottom: 0.06em; padding-left: 0.015em;"><span id="MJXc-Node-598" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">^</span></span></span><span class="mjx-op"><span id="MJXc-Node-597" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">a</span></span></span></span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-599" class="mjx-texatom" style=""><span id="MJXc-Node-600" class="mjx-mrow"><span id="MJXc-Node-601" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span><span id="MJXc-Node-602" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-603" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span></span></span><span id="MJXc-Node-604" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-605" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-606" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-607" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-608" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-609" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-610" class="mjx-texatom"><span id="MJXc-Node-611" class="mjx-mrow"><span id="MJXc-Node-612" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.213em; padding-bottom: 0.06em; padding-left: 0.015em;"><span id="MJXc-Node-614" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">^</span></span></span><span class="mjx-op"><span id="MJXc-Node-613" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">a</span></span></span></span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-615" class="mjx-texatom" style=""><span id="MJXc-Node-616" class="mjx-mrow"><span id="MJXc-Node-617" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span><span id="MJXc-Node-618" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-619" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>a</mi><mo stretchy="false">^</mo></mover></mrow><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>a</mi><mo stretchy="false">^</mo></mover></mrow><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>,</mo><mi>N</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-32">\hat{a}_{1,1},...,\hat{a}_{1,N}</script>：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea29327c2a9a83be5558220.jpg" alt=""></p>

<p>矩阵运算如下：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-33-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;msqrt&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-620" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-621" class="mjx-mrow"><span id="MJXc-Node-622" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span><span id="MJXc-Node-623" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-624" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 2.475em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.475em; top: -1.547em;"><span id="MJXc-Node-625" class="mjx-mrow"><span id="MJXc-Node-626" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.04em;"><span id="MJXc-Node-627" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.04em;">K</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0.144em; padding-right: 0.071em;"><span id="MJXc-Node-628" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.12em;">T</span></span></span></span><span id="MJXc-Node-629" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">Q</span></span></span></span><span class="mjx-denominator" style="width: 2.475em; bottom: -1.079em;"><span id="MJXc-Node-630" class="mjx-msqrt"><span class="mjx-box" style="padding-top: 0.045em;"><span class="mjx-surd"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.511em; padding-bottom: 0.561em;">√</span></span><span class="mjx-box" style="padding-top: 0.043em; border-top: 1.5px solid;"><span id="MJXc-Node-631" class="mjx-mrow"><span id="MJXc-Node-632" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-633" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-634" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span></span></span></span></span></span><span class="mjx-line" style="border-bottom: 1.3px solid; top: -0.282em; width: 2.475em;"></span></span><span class="mjx-vsize" style="height: 2.626em; vertical-align: -1.079em;"></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mo>=</mo><mfrac><mrow><msup><mi>K</mi><mi>T</mi></msup><mi>Q</mi></mrow><msqrt><msub><mi>D</mi><mi>k</mi></msub></msqrt></mfrac></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-33">A = \frac{K^TQ}{\sqrt{D_k}}</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-34-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-635" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-636" class="mjx-mrow"><span id="MJXc-Node-637" class="mjx-texatom"><span id="MJXc-Node-638" class="mjx-mrow"><span id="MJXc-Node-639" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.213em; padding-bottom: 0.06em; padding-left: 0.264em;"><span id="MJXc-Node-641" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.307em;">^</span></span></span><span class="mjx-op"><span id="MJXc-Node-640" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span></span></span></span></span></span><span id="MJXc-Node-642" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-643" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-644" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-645" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.06em;">f</span></span><span id="MJXc-Node-646" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.409em; padding-bottom: 0.307em;">t</span></span><span id="MJXc-Node-647" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span><span id="MJXc-Node-648" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">a</span></span><span id="MJXc-Node-649" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span><span id="MJXc-Node-650" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-651" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span><span id="MJXc-Node-652" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mover><mi>A</mi><mo stretchy="false">^</mo></mover></mrow><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-34">\hat{A} = softmax(A)</script>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea29480c2a9a83be557541f.jpg" alt=""></p>

<p>其中注意力得分选用<strong>缩放点积Scaled Dot-Product</strong>，其原因是后续的<strong>Softmax</strong>函数对较大或较小的输入非常敏感(容易映射到<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-35-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-653" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-654" class="mjx-mrow"><span id="MJXc-Node-655" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-35">1</script>或<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-36-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-656" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-657" class="mjx-mrow"><span id="MJXc-Node-658" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.385em;">0</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-36">0</script>)，因此通过因子<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-37-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-659" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-660" class="mjx-mrow"><span id="MJXc-Node-661" class="mjx-msqrt"><span class="mjx-box" style="padding-top: 0.045em;"><span class="mjx-surd"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.528em; padding-bottom: 0.528em;">√</span></span><span class="mjx-box" style="padding-top: 0.043em; border-top: 1.6px solid;"><span id="MJXc-Node-662" class="mjx-mrow"><span id="MJXc-Node-663" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-664" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-665" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">k</span></span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><msub><mi>D</mi><mi>k</mi></msub></msqrt></math></span></span><script type="math/tex" id="MathJax-Element-37">\sqrt{D_k}</script>进行缩放；<strong>Softmax</strong>函数按<strong>列</strong>运算。</p>

<h3 id="3-加权求和">(3) 加权求和<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#3-%E5%8A%A0%E6%9D%83%E6%B1%82%E5%92%8C"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p>根据注意力分布<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-38-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-666" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-667" class="mjx-mrow"><span id="MJXc-Node-668" class="mjx-texatom"><span id="MJXc-Node-669" class="mjx-mrow"><span id="MJXc-Node-670" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.213em; padding-bottom: 0.06em; padding-left: 0.264em;"><span id="MJXc-Node-672" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">^</span></span></span><span class="mjx-op"><span id="MJXc-Node-671" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">A</span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>A</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-38">\hat{A}</script>，<strong>加权求和</strong>得到输出：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea29582c2a9a83be558a1c7.jpg" alt=""></p>

<p>矩阵运算如下：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-39-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-673" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-674" class="mjx-mrow"><span id="MJXc-Node-675" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">B</span></span><span id="MJXc-Node-676" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-677" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.186em;">V</span></span><span id="MJXc-Node-678" class="mjx-texatom"><span id="MJXc-Node-679" class="mjx-mrow"><span id="MJXc-Node-680" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.213em; padding-bottom: 0.06em; padding-left: 0.264em;"><span id="MJXc-Node-682" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.409em; padding-bottom: 0.307em;">^</span></span></span><span class="mjx-op"><span id="MJXc-Node-681" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mo>=</mo><mi>V</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>A</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-39">B = V\hat{A}</script>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea295c1c2a9a83be558eecd.jpg" alt=""></p>

<p>自注意力模型的<strong>优点</strong>：</p>
<ol>
  <li>提高并行计算效率;</li>
  <li>捕捉长距离的依赖关系。</li>
</ol>

<p>自注意力模型可以看作在一个线性投影空间中建立<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-40-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-683" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-684" class="mjx-mrow"><span id="MJXc-Node-685" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.024em;">X</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-40">X</script>中不同向量之间的交互关系。上述自注意力运算的计算复杂度为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-41-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-686" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-687" class="mjx-mrow"><span id="MJXc-Node-688" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">O</span></span><span id="MJXc-Node-689" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">(</span></span><span id="MJXc-Node-690" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.085em;"><span id="MJXc-Node-691" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0.227em; padding-right: 0.071em;"><span id="MJXc-Node-692" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span></span></span><span id="MJXc-Node-693" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-41">O(N^2)</script>。实践中有些问题并不需要捕捉全局结构，只依赖于局部信息，此时可以使用<strong>restricted</strong>自注意力机制，即假设当前词只与前后<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-42-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-694" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-695" class="mjx-mrow"><span id="MJXc-Node-696" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">r</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-42">r</script>个词发生联系(类似于卷积中的滑动窗口)，此时计算复杂度为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-43-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-697" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-698" class="mjx-mrow"><span id="MJXc-Node-699" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">O</span></span><span id="MJXc-Node-700" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">(</span></span><span id="MJXc-Node-701" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">r</span></span><span id="MJXc-Node-702" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span><span id="MJXc-Node-703" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>r</mi><mi>N</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-43">O(rN)</script>。</p>

<h1 id="4-multi-head-self-attention">4. Multi-Head Self-Attention<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#4-multi-head-self-attention"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h1>
<p>为了提取更多的交互信息，可以使用<strong>多头自注意力(Multi-Head Self-Attention)</strong>，即在多个不同的投影空间中捕捉不同的交互信息。不妨类比于卷积神经网络，其一个卷积核通常用于捕捉某一类<strong>pattern</strong>的信息，故采用多个卷积核。自注意力机制采用多个<strong>head</strong>，便可以捕捉不同的相关性。在实践中，首先通过<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-44-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-704" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-705" class="mjx-mrow"><span id="MJXc-Node-706" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.081em;">M</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-44">M</script>个<strong>head</strong>生成<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-45-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-707" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-708" class="mjx-mrow"><span id="MJXc-Node-709" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.081em;">M</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-45">M</script>个不同的输出<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-46-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-710" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-711" class="mjx-mrow"><span id="MJXc-Node-712" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-713" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">B</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-714" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-715" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-716" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-717" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">B</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-718" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span></span></span><span id="MJXc-Node-719" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-720" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">…</span></span><span id="MJXc-Node-721" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-722" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-723" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">B</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-724" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.081em;">M</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>B</mi><mn>1</mn></msub><mo>,</mo><msub><mi>B</mi><mn>2</mn></msub><mo>,</mo><mo>…</mo><mo>,</mo><msub><mi>B</mi><mi>M</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-46">B_1,B_2,…,B_M</script>，将其合并后再通过一层全连接层进行线性变换：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea296f0c2a9a83be55a5633.jpg" alt=""></p>

<p>假设使用<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-47-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-725" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-726" class="mjx-mrow"><span id="MJXc-Node-727" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.081em;">M</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-47">M</script>个<strong>head</strong>，矩阵运算如下：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-48-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msubsup&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msqrt&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-728" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-729" class="mjx-mrow"><span id="MJXc-Node-730" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-731" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-732" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span></span></span><span id="MJXc-Node-733" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-734" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 3.152em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 3.152em; top: -1.555em;"><span id="MJXc-Node-735" class="mjx-mrow"><span id="MJXc-Node-736" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.04em;"><span id="MJXc-Node-737" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.04em;">K</span></span></span><span class="mjx-stack" style="vertical-align: -0.157em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.144em; padding-right: 0.071em;"><span id="MJXc-Node-739" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.12em;">T</span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-738" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span></span></span></span><span id="MJXc-Node-740" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-741" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em;">Q</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-742" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span></span></span></span></span><span class="mjx-denominator" style="width: 3.152em; bottom: -1.079em;"><span id="MJXc-Node-743" class="mjx-msqrt"><span class="mjx-box" style="padding-top: 0.045em;"><span class="mjx-surd"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.511em; padding-bottom: 0.561em;">√</span></span><span class="mjx-box" style="padding-top: 0.043em; border-top: 1.5px solid;"><span id="MJXc-Node-744" class="mjx-mrow"><span id="MJXc-Node-745" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-746" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-747" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">k</span></span></span></span></span></span></span></span></span><span class="mjx-line" style="border-bottom: 1.3px solid; top: -0.282em; width: 3.152em;"></span></span><span class="mjx-vsize" style="height: 2.634em; vertical-align: -1.079em;"></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>A</mi><mi>m</mi></msub><mo>=</mo><mfrac><mrow><msubsup><mi>K</mi><mi>m</mi><mi>T</mi></msubsup><msub><mi>Q</mi><mi>m</mi></msub></mrow><msqrt><msub><mi>D</mi><mi>k</mi></msub></msqrt></mfrac></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-48">A_m = \frac{K_m^TQ_m}{\sqrt{D_k}}</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-49-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-748" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-749" class="mjx-mrow"><span id="MJXc-Node-750" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-751" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">B</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-752" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span></span></span><span id="MJXc-Node-753" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-754" class="mjx-msubsup MJXc-space3"><span class="mjx-base" style="margin-right: -0.186em;"><span id="MJXc-Node-755" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.186em;">V</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-756" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span></span></span><span id="MJXc-Node-757" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-758" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-759" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.06em;">f</span></span><span id="MJXc-Node-760" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.409em; padding-bottom: 0.307em;">t</span></span><span id="MJXc-Node-761" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span><span id="MJXc-Node-762" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">a</span></span><span id="MJXc-Node-763" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">x</span></span><span id="MJXc-Node-764" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-765" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-766" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.511em; padding-bottom: 0.257em;">A</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-767" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">m</span></span></span></span><span id="MJXc-Node-768" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>B</mi><mi>m</mi></msub><mo>=</mo><msub><mi>V</mi><mi>m</mi></msub><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>A</mi><mi>m</mi></msub><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-49">B_m = V_msoftmax(A_m)</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-50-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-769" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-770" class="mjx-mrow"><span id="MJXc-Node-771" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">B</span></span><span id="MJXc-Node-772" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-773" class="mjx-msubsup MJXc-space3"><span class="mjx-base" style="margin-right: -0.104em;"><span id="MJXc-Node-774" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em; padding-right: 0.104em;">W</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.262em; padding-right: 0.071em;"><span id="MJXc-Node-775" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span></span></span><span id="MJXc-Node-776" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-777" class="mjx-mo" style="vertical-align: -0.981em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.917em; padding-bottom: 0.917em;">⎡</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.202em; margin-bottom: -0.101em; margin-top: 0px;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.917em; padding-bottom: 0.917em;">⎣</span></span></span><span id="MJXc-Node-778" class="mjx-mtable" style="vertical-align: -1.65em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-779" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-780" class="mjx-mtd" style="padding: 0px; width: 1.538em;"><span id="MJXc-Node-781" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-782" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-783" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">B</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-784" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-785" class="mjx-mtr" style="height: 1.4em;"><span id="MJXc-Node-786" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-787" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-788" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-789" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span id="MJXc-Node-790" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.358em;">.</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-791" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-792" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-793" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-794" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-795" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">B</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-796" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em; padding-right: 0.081em;">M</span></span></span></span><span class="mjx-strut"></span></span></span></span></span></span><span id="MJXc-Node-797" class="mjx-mo" style="vertical-align: -0.981em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.917em; padding-bottom: 0.917em;">⎤</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.202em; margin-bottom: -0.101em; margin-top: 0px;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.917em; padding-bottom: 0.917em;">⎦</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mo>=</mo><msup><mi>W</mi><mi>o</mi></msup><mrow><mo>[</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><msub><mi>B</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd><mo>.</mo><mo>.</mo><mo>.</mo></mtd></mtr><mtr><mtd><msub><mi>B</mi><mi>M</mi></msub></mtd></mtr></mtable><mo>]</mo></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-50">B = W^o \begin{bmatrix} B_1 \\ ... \\ B_M \\ \end{bmatrix}</script>

<p>在实现多头自注意力时，有两种常用的形式：</p>
<ol>
  <li><strong>Narrow Self-Attention</strong>：把输入词向量切割成<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-51-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-798" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-799" class="mjx-mrow"><span id="MJXc-Node-800" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">h</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">h</script>块，每一块使用一次自注意力运算；这种方法速度快，节省内存，但是效果不好；</li>
  <li><strong>Wide Self-Attention</strong>：对输入词向量独立地使用<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-52-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-801" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-802" class="mjx-mrow"><span id="MJXc-Node-803" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">h</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-52">h</script>次自注意力运算；这种方法效果更好，但花费更多时间和内存</li>
</ol>

<h1 id="5-position-encoding">5. Position Encoding<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#5-position-encoding"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h1>
<p>自注意力模型忽略了序列<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-53-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-804" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-805" class="mjx-mrow"><span id="MJXc-Node-806" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">[</span></span><span id="MJXc-Node-807" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-808" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-809" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">1</span></span></span></span><span id="MJXc-Node-810" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-811" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-812" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-813" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.337em;">.</span></span><span id="MJXc-Node-814" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-815" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-816" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-817" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-818" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.481em; padding-bottom: 0.576em;">]</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-53">[x_1,...,x_N]</script>中每个<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-54-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-819" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-820" class="mjx-mrow"><span id="MJXc-Node-821" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">x</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">x</script>的位置信息，即将该序列打乱后并不影响输出结果。因此在模型中显式的引入<strong>位置编码(position encoding)</strong><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-55-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-822" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-823" class="mjx-mrow"><span id="MJXc-Node-824" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">e</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">e</script>：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea29902c2a9a83be55cdc7b.jpg" alt=""></p>

<p>位置编码<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-56-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-825" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-826" class="mjx-mrow"><span id="MJXc-Node-827" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">e</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">e</script>是自注意力机制中获取序列<strong>位置</strong>信息的唯一来源，是模型重要的组成部分。位置编码既可以从数据中学习得到，也可以人为定义并加到词嵌入向量上。对位置编码的一些<strong>解释</strong>：</p>

<h3 id="1为什么是add而不是concatenate-">(1)为什么是add而不是concatenate ?<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#1%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AFadd%E8%80%8C%E4%B8%8D%E6%98%AFconcatenate-"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p>假设位置编码为<strong>one-hot</strong>形式，<strong>concatenate</strong>到输入向量上进行词嵌入：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea29a5ac2a9a83be55e6d0f.jpg" alt=""></p>

<p>结果等价于先对位置索引和输入序列分别进行词嵌入，再相加。此时的位置编码是一种<strong>位置嵌入(position embedding)</strong></p>

<h3 id="2设置位置编码">(2)设置位置编码<a class="anchor" href="https://0809zheng.github.io/2020/04/24/self-attention.html#2%E8%AE%BE%E7%BD%AE%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81"><i class="fa fa-anchor fa-lg anchor-icon" aria-hidden="true"></i></a></h3>
<p>位置编码通过下面方式进行预定义：</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-57-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;msup&gt;&lt;mn&gt;10000&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-828" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-829" class="mjx-mrow"><span id="MJXc-Node-830" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-831" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">e</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-832" class="mjx-texatom" style=""><span id="MJXc-Node-833" class="mjx-mrow"><span id="MJXc-Node-834" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.409em; padding-bottom: 0.307em;">t</span></span><span id="MJXc-Node-835" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-836" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span><span id="MJXc-Node-837" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span></span></span><span id="MJXc-Node-838" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-839" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-840" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-841" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-842" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-843" class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 3.428em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 3.428em; top: -1.328em;"><span id="MJXc-Node-844" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.409em; padding-bottom: 0.307em;">t</span></span></span><span class="mjx-denominator" style="width: 3.428em; bottom: -1.111em;"><span id="MJXc-Node-845" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-846" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">10000</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.605em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-847" class="mjx-texatom" style=""><span id="MJXc-Node-848" class="mjx-mrow"><span id="MJXc-Node-849" class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 0.739em; padding: 0px 0.12em;"><span class="mjx-numerator" style="font-size: 70.7%; width: 1.045em; top: -1.335em;"><span id="MJXc-Node-850" class="mjx-mrow" style=""><span id="MJXc-Node-851" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span><span id="MJXc-Node-852" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span><span class="mjx-denominator" style="font-size: 70.7%; width: 1.045em; bottom: -0.634em;"><span id="MJXc-Node-853" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-line" style="border-bottom: 1.2px solid; top: -0.292em; width: 0.739em;"></span></span><span class="mjx-vsize" style="height: 1.393em; vertical-align: -0.448em;"></span></span></span></span></span></span></span><span class="mjx-line" style="border-bottom: 1.3px solid; top: -0.282em; width: 3.428em;"></span></span><span class="mjx-vsize" style="height: 2.439em; vertical-align: -1.111em;"></span></span><span id="MJXc-Node-854" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>,</mo><mn>2</mn><mi>i</mi></mrow></msub><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mfrac><mi>t</mi><msup><mn>10000</mn><mrow class="MJX-TeXAtom-ORD"><mfrac><mrow><mn>2</mn><mi>i</mi></mrow><mi>D</mi></mfrac></mrow></msup></mfrac><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-57">e_{t,2i} = sin(\frac{t}{10000^{\frac{2i}{D}}})</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-58-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;msup&gt;&lt;mn&gt;10000&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-855" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-856" class="mjx-mrow"><span id="MJXc-Node-857" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-858" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">e</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-859" class="mjx-texatom" style=""><span id="MJXc-Node-860" class="mjx-mrow"><span id="MJXc-Node-861" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.409em; padding-bottom: 0.307em;">t</span></span><span id="MJXc-Node-862" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.511em;">,</span></span><span id="MJXc-Node-863" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span><span id="MJXc-Node-864" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-865" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">+</span></span><span id="MJXc-Node-866" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">1</span></span></span></span></span></span><span id="MJXc-Node-867" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-868" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">c</span></span><span id="MJXc-Node-869" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-870" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-871" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-872" class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 3.428em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 3.428em; top: -1.328em;"><span id="MJXc-Node-873" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.409em; padding-bottom: 0.307em;">t</span></span></span><span class="mjx-denominator" style="width: 3.428em; bottom: -1.111em;"><span id="MJXc-Node-874" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-875" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">10000</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.605em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-876" class="mjx-texatom" style=""><span id="MJXc-Node-877" class="mjx-mrow"><span id="MJXc-Node-878" class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 0.739em; padding: 0px 0.12em;"><span class="mjx-numerator" style="font-size: 70.7%; width: 1.045em; top: -1.335em;"><span id="MJXc-Node-879" class="mjx-mrow" style=""><span id="MJXc-Node-880" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.358em; padding-bottom: 0.358em;">2</span></span><span id="MJXc-Node-881" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span></span></span><span class="mjx-denominator" style="font-size: 70.7%; width: 1.045em; bottom: -0.634em;"><span id="MJXc-Node-882" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.257em;">D</span></span></span><span class="mjx-line" style="border-bottom: 1.2px solid; top: -0.292em; width: 0.739em;"></span></span><span class="mjx-vsize" style="height: 1.393em; vertical-align: -0.448em;"></span></span></span></span></span></span></span><span class="mjx-line" style="border-bottom: 1.3px solid; top: -0.282em; width: 3.428em;"></span></span><span class="mjx-vsize" style="height: 2.439em; vertical-align: -1.111em;"></span></span><span id="MJXc-Node-883" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>,</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mfrac><mi>t</mi><msup><mn>10000</mn><mrow class="MJX-TeXAtom-ORD"><mfrac><mrow><mn>2</mn><mi>i</mi></mrow><mi>D</mi></mfrac></mrow></msup></mfrac><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-58">e_{t,2i+1} = cos(\frac{t}{10000^{\frac{2i}{D}}})</script>

<p>其中<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-59-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-884" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-885" class="mjx-mrow"><span id="MJXc-Node-886" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-887" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">e</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-888" class="mjx-texatom" style=""><span id="MJXc-Node-889" class="mjx-mrow"><span id="MJXc-Node-890" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.385em; padding-bottom: 0.289em;">t</span></span><span id="MJXc-Node-891" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.189em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-892" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span><span id="MJXc-Node-893" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>,</mo><mn>2</mn><mi>i</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-59">e_{t,2i}</script>表示第<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-60-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-894" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-895" class="mjx-mrow"><span id="MJXc-Node-896" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.385em; padding-bottom: 0.289em;">t</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-60">t</script>个位置的编码向量的第<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-61-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-897" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-898" class="mjx-mrow"><span id="MJXc-Node-899" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.385em; padding-bottom: 0.337em;">2</span></span><span id="MJXc-Node-900" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.433em; padding-bottom: 0.289em;">i</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-61">2i</script>维，<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-62-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-901" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-902" class="mjx-mrow"><span id="MJXc-Node-903" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.289em;">D</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">D</script>是编码向量的维度。</p>

<p>选用该形式的位置编码的思路是，由于有:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-63-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-904" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-905" class="mjx-mrow"><span id="MJXc-Node-906" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-907" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-908" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-909" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-910" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">α</span></span><span id="MJXc-Node-911" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">+</span></span><span id="MJXc-Node-912" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-913" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-914" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-915" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-916" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-917" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-918" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-919" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">α</span></span><span id="MJXc-Node-920" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-921" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">c</span></span><span id="MJXc-Node-922" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-923" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-924" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-925" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-926" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-927" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">+</span></span><span id="MJXc-Node-928" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">c</span></span><span id="MJXc-Node-929" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-930" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-931" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-932" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">α</span></span><span id="MJXc-Node-933" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-934" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-935" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-936" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-937" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-938" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-939" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>α</mi><mo>+</mo><mi>β</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>β</mi><mo stretchy="false">)</mo><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>β</mi><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-63">sin(\alpha+\beta)=sin(\alpha)cos(\beta)+cos(\alpha)sin(\beta)</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-64-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 123%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-940" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-941" class="mjx-mrow"><span id="MJXc-Node-942" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">c</span></span><span id="MJXc-Node-943" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-944" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-945" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-946" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">α</span></span><span id="MJXc-Node-947" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">+</span></span><span id="MJXc-Node-948" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-949" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-950" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.307em;">=</span></span><span id="MJXc-Node-951" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">c</span></span><span id="MJXc-Node-952" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-953" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-954" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-955" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">α</span></span><span id="MJXc-Node-956" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-957" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">c</span></span><span id="MJXc-Node-958" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">o</span></span><span id="MJXc-Node-959" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-960" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-961" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-962" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-963" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.307em; padding-bottom: 0.409em;">−</span></span><span id="MJXc-Node-964" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-965" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-966" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-967" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-968" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">α</span></span><span id="MJXc-Node-969" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span><span id="MJXc-Node-970" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">s</span></span><span id="MJXc-Node-971" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.307em;">i</span></span><span id="MJXc-Node-972" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.307em;">n</span></span><span id="MJXc-Node-973" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">(</span></span><span id="MJXc-Node-974" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.46em; padding-bottom: 0.46em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-975" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.46em; padding-bottom: 0.612em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>α</mi><mo>+</mo><mi>β</mi><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>β</mi><mo stretchy="false">)</mo><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>β</mi><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-64">cos(\alpha+\beta)=cos(\alpha)cos(\beta)-sin(\alpha)sin(\beta)</script>

<p>因此位置<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-65-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-976" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-977" class="mjx-mrow"><span id="MJXc-Node-978" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">α</span></span><span id="MJXc-Node-979" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.289em; padding-bottom: 0.433em;">+</span></span><span id="MJXc-Node-980" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.481em; padding-right: 0.007em;">β</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo>+</mo><mi>β</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">\alpha+\beta</script>处的编码很容易被位置<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-66-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-981" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-982" class="mjx-mrow"><span id="MJXc-Node-983" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.242em; padding-bottom: 0.289em;">α</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-66">\alpha</script>和位置<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-67-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 123%; position: relative;"><span id="MJXc-Node-984" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-985" class="mjx-mrow"><span id="MJXc-Node-986" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.481em; padding-bottom: 0.481em; padding-right: 0.007em;">β</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></span></span><script type="math/tex" id="MathJax-Element-67">\beta</script>处的编码表示。通过实验发现位置嵌入和上述位置编码效果是接近的，因此直接选用后者。</p>

<p>上述位置编码也被称为<strong>Sinusoidal</strong>位置编码，其编码矩阵可视化如下：</p>

<p><img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea29a8ac2a9a83be55ea47e.jpg" alt=""></p>

<p>更多的位置编码形式可以参考<a href="https://0809zheng.github.io/2021/07/12/efficienttransformer.html"><font color="Blue">自注意力机制中的位置编码 (Position Encoding)</font></a>。</p>

    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share share-component"><a class="social-share-icon icon-wechat" href="javascript:"><div class="wechat-qrcode"><h4>分享到微信朋友圈</h4><div class="qrcode" title="https://0809zheng.github.io/2020/04/24/self-attention.html"><canvas width="100" height="100" style="display: none;"></canvas><img alt="Scan me!" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAB5xJREFUeF7tnVt240gMQ+39LzpzHMdtqUyCF5SS9nQ4fz0pS6wCSQCUH9fL5fJxaf738bF/6fV6fbnSuia61fo69Rq19vE3556PtVHsj1iz621fQ65Djvl2ggPI5XJ5O0BIVj0QXjPR2YzKKlVxTgaua6PXkjVZhahKdKp0Pc/bv/9UyABybxSk7f4oICTbs4DUZsgm1h7rJMn2tSQ+UiHVmii+TvfYnttLhQwgT2HyTwFCFFilOkiFdKsy6t+3/9fN+gq8aK8Rt31bhQwgOSetYuGvtKwsI7eZ062IrNKyrFVeaBvDET4gqvBHK6SSjKqEVStTHJeJAiJFozUDyOL8iatX4P0TFVIR7Varqw1n2RW1BFJNncOtRh8UcNJKM9PsnOfpxpD03wHkFaKQ1AmSTo92KoRIxjPWdBOmc+/Oee4qpHOBs1pWZ8Od+dT/ApAPp0EmqJH5DwFcqZoOh5CtESWVXScalJJ9ShU5gNxHJco3vBUgRPd3TZCTTeQeGcc599murfauxixE4YXep6qQKqgqu9bAyPWUaXReT1rWERP6LYA8nhiS4Kt+65JmN3O3Xmh7DSIOiOepsrs70EQTgwHkfvyOMBlAglJyDoUcNlnzCMO5d8RJqhtdKw5RJLde2JWBWQmfNehzWiLhJnmQwTtutvxKz3EA+TqptwOkIuyIPEkGrhtVxL+2BGctiY+0JQXM2eY0utefChlAcnLPpDtpYWTNrp2tb5QjWYDk21dPdQOivoZ4FWImyZpKBmcqLeMQ6X0GkPrZ918BJMuUjmF03W+m1giHEPWiVNsaq3LfRFWS7iG5cjWGioSzg+4EoUiYyN4oliz2AUSUiKN0pkI2B0l0OZG9mUKJyNsRAM64XFUw2afTUhXfZEp2l3jZLIsEOoA8P8lBWv0hQFbicXt+9vqoDRFiVURIE8OdQR0Z7ZCYQm6rpr3dnj+A1JCEgFTDxWhgeMTVO6MJZf4iwCvpTpJLyWjiR4jkV+a7HC4OIK9HTLyZkuUSkMyHEINEiGwNLAL4CD+o65FsdVSR4tWMB939ph9HGECeTxGVQ89Aj9onks8rhxDXjeTb8sCGlLnjF0jCkOpUfFjFrNq5qk6LQwaQ14+0ZYc7gGxO5tdUyBGCJZKxVufPFcpEkjGL0/vJKIZ0j875bSstlb3OzZXEcwBQjt1RdJXDVv7GdfNVO6t46PZ6BIgj8RwD50xwv2ueth5ClTTZobrxtVSWUiZV4Nu/o5sXj3ndDVfxkTkaSa5usqIzyUYnzpiBtLfOGjJmUe2SPOFzDpfwDEloS/aqAKvS7RBtJATUxh/rO/cirtnxD6ojkHNEw0WSlY4x7GQVyVrlhEmrc8iWqLUs64lX2bXSzKkTJSJLb+EHpwUOIJvTnwp5HoYjn0+rkGraS6apZ2l3RYiqGgmR3taQNlUptUwyV/xKFOjntQcQAsF+jdN+ydqdMcy+c5Eona4iyZSScuOEqLN4lABY+cpRb25MyIcMIHdIzvZJxGAi2esXsPcKxwsoZ93JesJ1Ua93K6HyJ7ITVG9y8I67Xj2AvH6ecZd4HVLPMkYNDl1yq/jA8SrRWkcVrbEQtaZaoKyQAaRWUG8PiJOdJFOcjHMOx1FtUQwV0RMTrZp4SOqdChlA9sqMKKpozQCy+QpBVT3Um3xLhTxUFgkwC5TIQtUSMqNIs4rG5cZAxMsaowOS9CEDyP1olfchiXMaIBn5uGZqDbpD6kQid3hMmb4OqW+vt+4zzP7kkYR8HkJKkMy5yHQ2A2sACcqDVIYjV8mTwyzLlHR0hoGEk9QkQcVBEplI9vJ9WW6ZZ4ENIK9whm2y+oyhUwVEj0cZSFqXM+rIxtwqvk7PJ3tx2u8tvvQXdiqXGhHaAPI6xh9Agke1RIq+XYVkGluVpdLlma8hGeMcYMRxFY99tobk8yskPkXuSpiQtvvys3mq/2bE7DhgsuEBJICcGCV1cJnEU7KSZJcjjZUXIkKCyNTKoLrOP/1hyQGEydTTAake4RJp1+2pldFykyKrCKeSHd/lmuesutujEzIOqQjVOZxfDQg5qMokkmuQDOwSfyU6iGKsqvb296PjGjVmefkSTBXQAHI/nW8FpBqdqIxefchRuepWWJXNZCpNvBTxD1UsxC99+qMBJM/6anzUTSBZYQPImwFSyV5SiiqTOmbPkdHR2ixzSe+PrkdaFllDjGb59UwDSE7iaupQGcZMHKROnQDRIU2yCWczXeOKTJrxsW1iSrM54c4YZh9HGEDqjyiQZHBmd1JlOX3c4ZDtdassJRtWHKIq+MhTxbN4Jjq3VPYOIM8TIK2ZkLrVspybVplNwFSOlwztOi01GoU7+17v6fqQAeTrvbxhawCfo1cu/rPfJz9zlCXLAPJbASHE6hi4KjOrdrVmbtSWHFIn8ZB7outUP1ex3bzzPKSaA5GSr6bLGTDkcAaQr9MjUpY8D3Gq0uEQ8lCMVLuqSmkTfrpCBhBtOE/xIUTmkj5eccO2zTnXI2qIZLSKj/iQFod0DmUAYQNICxACxLqGjLOd8cXj+qTnr2uj+B1R0KkiZ/9RdUd7OGXaSwjWIeoBpFMe5sP+AYR9uf9/Vq4N+4kT+9sAAAAASUVORK5CYII=" style="display: block;"></div><div class="help"><p>扫码后点击右上角</p><p>将本文分享至朋友圈</p></div></div></a><a class="social-share-icon icon-weibo" href="http://service.weibo.com/share/share.php?url=https%3A%2F%2F0809zheng.github.io%2F2020%2F04%2F24%2Fself-attention.html&amp;title=%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6(Self-Attention%20Mechanism)%20-%20%E9%83%91%E4%B9%8B%E6%9D%B0%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99&amp;pic=https%3A%2F%2Fpic.imgdb.cn%2Fitem%2F60ebc1765132923bf88a64f9.jpg&amp;appkey=" target="_blank"></a><a class="social-share-icon icon-douban" href="http://shuo.douban.com/!service/share?href=https%3A%2F%2F0809zheng.github.io%2F2020%2F04%2F24%2Fself-attention.html&amp;name=%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6(Self-Attention%20Mechanism)%20-%20%E9%83%91%E4%B9%8B%E6%9D%B0%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99&amp;text=%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6(Self-Attention%20Mechanism)&amp;image=https%3A%2F%2Fpic.imgdb.cn%2Fitem%2F60ebc1765132923bf88a64f9.jpg&amp;starid=0&amp;aid=0&amp;style=11" target="_blank"></a><a class="social-share-icon icon-twitter" href="https://twitter.com/intent/tweet?text=%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6(Self-Attention%20Mechanism)%20-%20%E9%83%91%E4%B9%8B%E6%9D%B0%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99&amp;url=https%3A%2F%2F0809zheng.github.io%2F2020%2F04%2F24%2Fself-attention.html&amp;via=https%3A%2F%2F0809zheng.github.io" target="_blank"></a></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/6184e14b2ab3f51d912026fc.jpg" alt="">
      </div>
      <div class="author-name" rel="author">郑之杰</div>
      <div class="bio">
        <p>热爱旅行家，深度学习者</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="https://github.com/0809zheng" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
        <li>
          <a href="https://weibo.com/u/5627414506" target="_blank">
                    <i class="iconfont icon-weibo"></i>
                </a>
        </li>
        
        <li>
          <a href="https://zhihu.com/people/zheng-zhi-jie-36" target="_blank">
                    <i class="iconfont icon-zhihu"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      
      <div class="read-next-item">
        <a href="https://0809zheng.github.io/2020/04/25/transformer.html" class="read-next-link"></a>
        <section style="margin-top: 90.75px; display: block;">
          <span>Transformer</span>
          <p>  Transformer，基于Multi-head self-attention的Seq2Seq模型.</p>
        </section>
        
        <div class="filter"></div>
        <img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea28751c2a9a83be5467bc1.jpg" alt="" style="width: auto; height: 100%; display: inline;">
        
     </div>
      

      
      <div class="read-next-item">
        <a href="https://0809zheng.github.io/2020/04/23/memory-network.html" class="read-next-link"></a>
          <section style="margin-top: 73px; display: block;">
            <span>记忆增强神经网络(Memory Augmented Neural Network)</span>
            <p>  Memory Augmented Neural Network.</p>
          </section>
          
          <div class="filter"></div>
          <img src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/5ea17d6bc2a9a83be50883e2.jpg" alt="" style="width: auto; height: 100%; display: inline;">
          
      </div>
      
    </section>
    
    <section class="post-footer-item comment">
      <div id="disqus_thread"><div class="gt-container"><div class="gt-no-init"><p>未找到相关的 <a href="https://github.com/0809zheng/0809zheng.github.io/issues">Issues</a> 进行评论</p><p>请联系 @0809zheng 初始化创建</p><button class="gt-btn gt-btn-login"><span class="gt-btn-text">使用 GitHub 登录</span></button></div></div></div>
      <div id="gitalk_container"></div>
    </section>
  </section>

  <footer class="g-footer">
  <section>郑之杰的个人网站 ©
  
  
    2020
    -
  
  2023
  </section>
  <section>Powered by <a href="https://jekyllrb.com/">Jekyll</a></section>
</footer>


  <script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/social-share.min.js"></script>
  <script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/gitalk.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>

  
	
  
    <script>
        var gitalk = new Gitalk({
              clientID: 'd45b6dcdac0458c21c03',
              clientSecret: '875ea1d909ddd834f6e6dc7448d0616eec1096a2',
              repo: '0809zheng.github.io',
              owner: '0809zheng',
              admin: '0809zheng',
              id: location.pathname,      // Ensure uniqueness and length less than 50自注意力机制(Self-Attention Mechanism)
              distractionFreeMode: 'true'  // Facebook-like distraction free mode
            })

            gitalk.render('disqus_thread')
    </script>
  

  <script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/prism.js"></script>
  <script src="./自注意力机制(Self-Attention Mechanism) - 郑之杰的个人网站_files/index.min.js"></script>



</body><div style="all: initial;"><div id="__hcfy__" style="all: initial;"><template shadowrootmode="open"><style>#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system,"BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Open Sans","Helvetica Neue","Icons16",sans-serif}#root{touch-action:manipulation}#root>.bp5-portal{z-index:9999999999}</style><link rel="stylesheet" href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/normalize.css"><link rel="stylesheet" href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/blueprint.css"><link rel="stylesheet" href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/blueprint-select.css"><link rel="stylesheet" href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/cropper.css"><style>#translate-panel{background-color:#f6f7f9;display:flex;flex-direction:column;padding-bottom:8px}.bp5-dark #translate-panel{background-color:#252a31}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp5-heading,#translate-panel.size-small .bp5-control.bp5-large,#translate-panel.size-small textarea.bp5-input.bp5-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp5-heading,#translate-panel.size-middle .bp5-control.bp5-large,#translate-panel.size-middle textarea.bp5-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp5-heading,#translate-panel.size-large .bp5-control.bp5-large,#translate-panel.size-large textarea.bp5-input.bp5-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp5-button.bp5-small,#translate-panel .bp5-small .bp5-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp5-dark #translate-panel .header{border-bottom-color:rgba(17,20,24,.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp5-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp5-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp5-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp5-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp5-input{min-height:44px;font-family:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp5-card:first-child{margin-top:1px}#translate-panel .body .bp5-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp5-button{visibility:hidden}.result-block .error .bp5-button,.result-block:hover .bp5-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp5-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp5-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp5-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity .2s;background-color:#f6f7f9}.bp5-dark #popper-container{background-color:#252a31}#popper-container.show{opacity:1;pointer-events:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden=true]{opacity:0;pointer-events:none;user-select:none}#popper-container .drag-block{cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:"";transform:rotate(45deg);background:#f6f7f9}.bp5-dark #popper-container .arrow::before{background-color:#252a31}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden=true]) .arrow{display:block}#popper-container[data-popper-placement^=top] .arrow{bottom:-5px}#popper-container[data-popper-placement^=top] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^=bottom] .arrow{top:-5px}#popper-container[data-popper-placement^=bottom] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=left] .arrow{right:-5px}#popper-container[data-popper-placement^=left] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=right] .arrow{left:-5px}#popper-container[data-popper-placement^=right] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp5-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url(chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/logo.png);background-size:contain}.bp5-dark #translate-btn .btn-icon{background-image:url(chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/logowhite36.png)}#translate-btn.show{display:block}.translate-type-selector .bp5-label{display:inline}.translate-type-selector .bp5-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp5-icon-pin{transition:transform .2s,color .2s;transform:rotate(-45deg)}.pin .switch-pin .bp5-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed !important;z-index:9999999999 !important}.app-toaster-container .bp5-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0;padding-left:0}#web-trs-panel .page-trs-form-group{margin:0 0 0 0;align-items:center}#web-trs-panel .page-trs-form-group>label{width:70px}</style><div id="root" dir="ltr" class="bp5-dark"><div id="app" class="bp5-dark"><div id="translate-btn" style=""><button type="button" class="bp5-button"><span class="btn-icon"></span></button></div><div id="popper-container" class="pin bp5-elevation-4" style="width: 290px; transform: translate(0px, 0px);"><div id="translate-panel" class="size-small" style="max-height: 790px;"><div class="fixed"><div class="header"><div class="left"><div class="switch-pin"><button type="button" class="bp5-button bp5-active bp5-minimal bp5-small"><span aria-hidden="true" class="bp5-icon bp5-icon-pin"><svg data-icon="pin" height="14" role="img" viewBox="0 0 16 16" width="14"><path d="M9.41.92c-.51.51-.41 1.5.15 2.56L4.34 7.54C2.8 6.48 1.45 6.05.92 6.58l3.54 3.54-3.54 4.95 4.95-3.54 3.54 3.54c.53-.53.1-1.88-.96-3.42l4.06-5.22c1.06.56 2.04.66 2.55.15L9.41.92z" fill-rule="evenodd"></path></svg></span></button></div><button type="button" title="图片翻译" class="bp5-button bp5-minimal bp5-small"><span aria-hidden="true" class="bp5-icon bp5-icon-media"><svg data-icon="media" height="14" role="img" viewBox="0 0 16 16" width="14"><path d="M11.99 6.99c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm3-5h-14c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-10c0-.55-.45-1-1-1zm-1 9l-5-3-1 2-3-4-3 5v-7h12v7z" fill-rule="evenodd"></path></svg></span></button><button type="button" title="语音翻译" class="bp5-button bp5-minimal bp5-small"><span class="bp5-icon"><svg version="1.1" id="Capa_1" width="14" height="14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 490.9 490.9" xml:space="preserve"><g><g><path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5 C149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5 c0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"></path><path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3 s5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8 c0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9 C106.6,220,101.2,214.5,94.4,214.5z"></path></g></g></svg></span></button></div><div class="drag-block" title="按住不放可以拖动"></div><div class="right"><div style="font-size: 0px; position: relative;"><button type="button" title="你有 2 条未读消息" class="bp5-button bp5-minimal bp5-small"><span aria-hidden="true" class="bp5-icon bp5-icon-notifications"><svg data-icon="notifications" height="14" role="img" viewBox="0 0 16 16" width="14"><path d="M8 16c1.1 0 2-.9 2-2H6c0 1.1.9 2 2 2zm6-5c-.55 0-1-.45-1-1V6c0-2.43-1.73-4.45-4.02-4.9 0-.04.02-.06.02-.1 0-.55-.45-1-1-1S7 .45 7 1c0 .04.02.06.02.1A4.992 4.992 0 003 6v4c0 .55-.45 1-1 1s-1 .45-1 1 .45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z" fill-rule="evenodd"></path></svg></span></button><div style="position: absolute; background: rgb(243, 1, 1); width: 6px; height: 6px; border-radius: 3px; right: 3px; top: 1px;"></div></div><button type="button" disabled="" title="添加到收藏夹" class="bp5-button bp5-disabled bp5-minimal bp5-small" tabindex="-1"><span aria-hidden="true" class="bp5-icon bp5-icon-star-empty"><svg data-icon="star-empty" height="14" role="img" viewBox="0 0 16 16" width="14"><path d="M16 6.11l-5.53-.84L8 0 5.53 5.27 0 6.11l4 4.1L3.06 16 8 13.27 12.94 16 12 10.21l4-4.1zM4.91 13.2l.59-3.62L3 7.02l3.45-.53L8 3.2l1.55 3.29 3.45.53-2.5 2.56.59 3.62L8 11.49 4.91 13.2z" fill-rule="evenodd"></path></svg></span></button><button type="button" class="bp5-button bp5-minimal bp5-small settings" title="快捷设置"><span aria-hidden="true" class="bp5-icon bp5-icon-cog"><svg data-icon="cog" height="14" role="img" viewBox="0 0 16 16" width="14"><path d="M15.19 6.39h-1.85c-.11-.37-.27-.71-.45-1.04l1.36-1.36c.31-.31.31-.82 0-1.13l-1.13-1.13a.803.803 0 00-1.13 0l-1.36 1.36c-.33-.17-.67-.33-1.04-.44V.79c0-.44-.36-.8-.8-.8h-1.6c-.44 0-.8.36-.8.8v1.86c-.39.12-.75.28-1.1.47l-1.3-1.3c-.3-.3-.79-.3-1.09 0L1.82 2.91c-.3.3-.3.79 0 1.09l1.3 1.3c-.2.34-.36.7-.48 1.09H.79c-.44 0-.8.36-.8.8v1.6c0 .44.36.8.8.8h1.85c.11.37.27.71.45 1.04l-1.36 1.36c-.31.31-.31.82 0 1.13l1.13 1.13c.31.31.82.31 1.13 0l1.36-1.36c.33.18.67.33 1.04.44v1.86c0 .44.36.8.8.8h1.6c.44 0 .8-.36.8-.8v-1.86c.39-.12.75-.28 1.1-.47l1.3 1.3c.3.3.79.3 1.09 0l1.09-1.09c.3-.3.3-.79 0-1.09l-1.3-1.3c.19-.35.36-.71.48-1.1h1.85c.44 0 .8-.36.8-.8v-1.6a.816.816 0 00-.81-.79zm-7.2 4.6c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z" fill-rule="evenodd"></path></svg></span></button><button type="button" title="关闭(Esc)" class="bp5-button bp5-minimal bp5-small"><span aria-hidden="true" class="bp5-icon bp5-icon-cross"><svg data-icon="cross" height="18" role="img" viewBox="0 0 16 16" width="18"><path d="M9.41 8l3.29-3.29c.19-.18.3-.43.3-.71a1.003 1.003 0 00-1.71-.71L8 6.59l-3.29-3.3a1.003 1.003 0 00-1.42 1.42L6.59 8 3.3 11.29c-.19.18-.3.43-.3.71a1.003 1.003 0 001.71.71L8 9.41l3.29 3.29c.18.19.43.3.71.3a1.003 1.003 0 00.71-1.71L9.41 8z" fill-rule="evenodd"></path></svg></span></button></div></div><div class="bp5-collapse"><div class="bp5-collapse-body" aria-hidden="true"><div class="quick-settings bp5-card bp5-elevation-0"><div><span aria-controls="listbox-0" aria-haspopup="listbox" class="lang-select bp5-popover-target" aria-expanded="false" role="combobox"><button type="button" class="bp5-button bp5-small"><span class="bp5-button-text">自动检测</span><span aria-hidden="true" class="bp5-icon bp5-icon-caret-down"><svg data-icon="caret-down" height="16" role="img" viewBox="0 0 16 16" width="16"><path d="M12 6.5c0-.28-.22-.5-.5-.5h-7a.495.495 0 00-.37.83l3.5 4c.09.1.22.17.37.17s.28-.07.37-.17l3.5-4c.08-.09.13-.2.13-.33z" fill-rule="evenodd"></path></svg></span></button></span><span aria-hidden="true" class="bp5-icon bp5-icon-arrow-right" style="margin: 0px 10px;"><svg data-icon="arrow-right" height="12" role="img" viewBox="0 0 16 16" width="12"><path d="M14.7 7.29l-5-5a.965.965 0 00-.71-.3 1.003 1.003 0 00-.71 1.71l3.29 3.29H1.99c-.55 0-1 .45-1 1s.45 1 1 1h9.59l-3.29 3.29a1.003 1.003 0 001.42 1.42l5-5c.18-.18.29-.43.29-.71s-.12-.52-.3-.7z" fill-rule="evenodd"></path></svg></span><span aria-controls="listbox-1" aria-haspopup="listbox" class="lang-select bp5-popover-target" aria-expanded="false" role="combobox"><button type="button" class="bp5-button bp5-small"><span class="bp5-button-text">中文(简体)</span><span aria-hidden="true" class="bp5-icon bp5-icon-caret-down"><svg data-icon="caret-down" height="16" role="img" viewBox="0 0 16 16" width="16"><path d="M12 6.5c0-.28-.22-.5-.5-.5h-7a.495.495 0 00-.37.83l3.5 4c.09.1.22.17.37.17s.28-.07.37-.17l3.5-4c.08-.09.13-.2.13-.33z" fill-rule="evenodd"></path></svg></span></button></span></div><div><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox" checked=""><span class="bp5-control-indicator"></span>谷歌</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox" checked=""><span class="bp5-control-indicator"></span>DeepL</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>ChatGPT</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>Yandex</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>百度</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>百度(专业版)</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>腾讯</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>彩云</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>阿里</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>阿里(专业版)</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>有道</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>火山</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>必应词典</label><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>搜狗</label></div><div><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>自动朗读</label><span aria-haspopup="true" class="bp5-popover-target"><label class="bp5-control bp5-checkbox bp5-disabled bp5-inline"><input disabled="" tabindex="0" type="checkbox"><span class="bp5-control-indicator"></span>自动复制</label></span></div><div><label class="bp5-control bp5-radio bp5-inline"><input name="Blueprint5.RadioGroup-0" type="radio" value="small" checked=""><span class="bp5-control-indicator"></span>小</label><label class="bp5-control bp5-radio bp5-inline"><input name="Blueprint5.RadioGroup-0" type="radio" value="middle"><span class="bp5-control-indicator"></span>中</label><label class="bp5-control bp5-radio bp5-inline"><input name="Blueprint5.RadioGroup-0" type="radio" value="large"><span class="bp5-control-indicator"></span>大</label></div><div><label class="bp5-control bp5-checkbox bp5-inline"><input type="checkbox"><span class="bp5-control-indicator"></span>显示文本框</label><label class="bp5-control bp5-checkbox bp5-inline" style="margin-right: 0px;"><input type="checkbox"><span class="bp5-control-indicator"></span>鼠标悬浮取词</label></div><a class="bp5-text-small">打开完整设置</a><a class="bp5-text-small" style="margin-left: 15px;"><span aria-hidden="true" class="bp5-icon bp5-icon-crown" style="position: relative; top: -1px;"><svg data-icon="crown" height="14" role="img" viewBox="0 0 16 16" width="14"><path d="M2 6l3 2 3-4 3 4 3-2-1 6H3L2 6zm6-5a1 1 0 110 2 1 1 0 010-2zM1 3a1 1 0 110 2 1 1 0 010-2zm14 0a1 1 0 110 2 1 1 0 010-2zM3 13h10v2H3v-2z" fill-rule="evenodd"></path></svg></span> 开通会员</a></div></div></div></div><div class="body"><p>请输入需要翻译的文本。</p></div></div><div class="arrow"></div></div><div id="web-trs-panel"></div></div></div></template></div></div></html>
## 旋转矩阵
欧氏变换由旋转和平移组成。我们首先考虑旋转。设某个单位正交基 $\left(e_1, e_2, e_3\right)$ 经过一次增转变成了 $\left(e_1^{\prime}, e_2^{\prime}, e_3^{\prime}\right)$ 。那么, 对于同一个向量 $a$ (该向量并没有随着坐标系的旋转而发生运动),它在两个坐标系下的坐标为 $\left[a_1, a_2, a_3\right]^{\mathrm{T}}$ 和 $\left[a_1^{\prime}, a_2^{\prime}, a_3^{\prime}\right]^{\mathrm{T}}$ 。因为向量本身没变, 所以根据坐标的定义, 有

$$
\left[e_1, e_2, e_3\right]\left[\begin{array}{c}
a_1 \\
a_2 \\
a_3
\end{array}\right]=\left[e_1^{\prime}, e_2^{\prime}, e_3^{\prime}\right]\left[\begin{array}{c}
a_1^{\prime} \\
a_2^{\prime} \\
a_3^{\prime}
\end{array}\right]
$$

为了描述两个坐标之间的关系, 我们对上述等式的左右两边同时左乘 $\left[\begin{array}{l}e_1^T \\ e_2^T \\ e_3^T\end{array}\right]$, 那么左边的系数就变成了单位矩阵, 所以:
$$
\left[\begin{array}{l}
a_1 \\
a_2 \\
a_3
\end{array}\right]=\left[\begin{array}{rrr}
e_1^{\mathrm{T}} e_1^{\prime} & e_1^{\mathrm{T}} e_2^{\prime} & e_1^{\mathrm{T}} e_3^{\prime} \\
e_2^{\mathrm{T}} e_1^{\prime} & e_2^{\mathrm{T}} e_2^{\prime} & e_2^{\mathrm{T}} e_3^{\prime} \\
e_3^{\mathrm{T}} e_1^{\prime} & e_3^{\mathrm{T}} e_2^{\prime} & e_3^{\mathrm{T}} e_3^{\prime}
\end{array}\right]\left[\begin{array}{c}
a_1^{\prime} \\
a_2^{\prime} \\
a_3^{\prime}
\end{array}\right] \stackrel{\text { def }}{=} R a^{\prime}
$$

。同时, 该矩阵各分量是两个坐标系基的内积，由于基向量的长度为 1 , 所以实际上是各基向量夹角的余弦值。所以这个矩阵也叫***方向余弦矩阵*** 

施转矩阵有一些特别的性质。事实上，它是一个行列式为 1 的正交矩阵。反之，行列式为 1 的正交矩阵也是一个旋转矩阵。所以，可以将 $n$ 维施转矩阵的集合定义如下：
$$
\mathrm{SO}(n)=\left\{\boldsymbol{R} \in \mathbb{R}^{n \times n} \mid \boldsymbol{R} \boldsymbol{R}^{\mathrm{T}}=\boldsymbol{I}, \operatorname{det}(\boldsymbol{R})=1\right\} .
$$
由于旋转矩阵是正交矩阵，它的逆（即转置）刻画了一个相反的旋转
$$
a^{\prime}=R^{-1} a=R^T a
$$
## 变换矩阵
不过还存在一个小问题: 这里的变换关系是一个线性关系。假设我们进行了两次变换: $\boldsymbol{R}_1, \boldsymbol{t}_1$ 和 $\boldsymbol{R}_2, \boldsymbol{t}_2$ :
$$
b=R_1 a+t_1, \quad c=R_2 b+t_2
$$

那么, 从 $\boldsymbol{a}$ 到 $\boldsymbol{c}$ 的变换为
$$
c=R_2\left(R_1 a+t_1\right)+t_2
$$

这样的形式在变换多次之后会显得很罗嗦。因此, 我们引人齐次坐标和变换矩阵
$$
\left[\begin{array}{l}
a^{\prime} \\
1
\end{array}\right]=\left[\begin{array}{ll}
\boldsymbol{R} & t \\
0^{\mathrm{T}} & 1
\end{array}\right]\left[\begin{array}{l}
\boldsymbol{a} \\
1
\end{array}\right] \stackrel{\text { def }}{=} \boldsymbol{T}\left[\begin{array}{l}
\boldsymbol{a} \\
1
\end{array}\right]
$$

这是一个数学技巧: 我们在一个三维向量的末尾添加 1 , 将其变成了四维向量, 称为齐次坐标。对于这个四维向量, 我们可以把旋转和平移写在一个矩阵里, 使得整个关系变成线性关系。该式中, 矩阵 $T$ 称为变换矩阵 (Transform Matrix)。这种矩阵又称***特殊欧式群***
$$
\mathrm{SE}(3)=\left\{\boldsymbol{T}=\left[\begin{array}{ll}
\boldsymbol{R} & \boldsymbol{t} \\
\mathbf{0}^{\mathrm{T}} & 1
\end{array}\right] \in \mathbb{R}^{4 \times 4} \mid \boldsymbol{R} \in \mathrm{SO}(3), t \in \mathbb{R}^3\right\}
$$

与 $\mathrm{SO}(3)$ 一样, 求解该矩阵的逆表示一个反向的变换:
$$
T^{-1}=\left[\begin{array}{cc}
\boldsymbol{R}^{\mathrm{T}} & -\boldsymbol{R}^{\mathrm{T}} \boldsymbol{t} \\
\mathbf{0}^{\mathrm{T}} & 1
\end{array}\right]
$$
## 旋转向量
事实上任意旋转都可以用一个旋转轴和旋转角来刻画，
因此我们可以使用一个向量，***其方向与旋转轴一致，而长度等于旋转角***。这种向量被称为***旋转向量***
然后通过罗德里格斯公式，将旋转向量转为旋转矩阵
>https://www.cnblogs.com/wtyuan/p/12324495.html 证明过程
$$
\boldsymbol{R}=\cos \theta \boldsymbol{I}+(1-\cos \theta) \boldsymbol{n} \boldsymbol{n}^{\mathrm{T}}+\sin \theta \boldsymbol{n}^{\wedge}
$$

符号 ^ 是向量到反对称矩阵的转换符, 见式 (3.3)。反之, 我们也可以计算从一个旋转矩阵到旋转向量的转换。对于转角 $\theta$, 取两边的迹(2), 有
$$
\begin{aligned}
\operatorname{tr}(\boldsymbol{R}) & =\cos \theta \operatorname{tr}(\boldsymbol{I})+(1-\cos \theta) \operatorname{tr}\left(\boldsymbol{n} \boldsymbol{n}^{\mathrm{T}}\right)+\sin \theta \operatorname{tr}\left(\boldsymbol{n}^{\wedge}\right) \\
& =3 \cos \theta+(1-\cos \theta) \\
& =1+2 \cos \theta
\end{aligned}
$$

因此:
$$
\theta=\arccos \frac{\operatorname{tr}(R)-1}{2}
$$
## 欧拉角
***将一个旋转分解成3次绕不同轴的旋转***。适合人类理解，但是具有奇异性问题，比如万向锁问题，因此不适用于差值和迭代。
在不同领域中有不同的欧拉角定义。我们以航空中的rpy角为例
1. 绕物体的 $Z$ 轴旋转, 得到偏航角 yaw。
2. 绕旋转之后的 $Y$ 轴旋转, 得到俯仰角 pitch。
3. 绕旋转之后的 $X$ 轴旋转, 得到滚转角 roll。
## 四元数
证明过程
https://zh.wikipedia.org/wiki/%E5%9B%9B%E5%85%83%E6%95%B0%E4%B8%8E%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AC
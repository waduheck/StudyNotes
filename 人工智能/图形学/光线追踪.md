可以将光线**简单**的分为3类：

**1. 镜面反射**

**2. 漫反射**

**3. 环境光**

## HDR环境图与
## BRDF函数（双向反射分布函数）
想象你有一个不透明的桌面，一个激光发射器。你先让激光向下垂直地射在那个桌面上，这样你就可以在桌面上看到一个亮点，接着你从各个不同的方向来观察那个亮点，你会发现亮点的亮度随着观察方向的不同而发生了改变。然后你站着不动，改变激光发射方向和桌面的夹角，你又会发现亮点的亮度发生了改变。这就是说，一个表面对不同的光线入射角和反射角的组合，拥有不同的反射率。BRDF就是用来对这种反射性质进行定义的。
  
作者：大饼土博  
链接：https://www.zhihu.com/question/20286038/answer/14621444  
来源：知乎  

https://www.cnblogs.com/jerrycg/p/4932031.html

BRDF是双向反射分布函数（Bidirectional Reflectance Distribution Function）的缩写，它是一个四维函数，描述了光如何在不同的表面上反射。具体来说，BRDF定义了一个表面在特定的入射光方向和反射光方向下的反射特性。

### 数学定义

BRDF函数 $f_r(\omega_i, \omega_r)$ 表示了从入射方向 \( \omega_i \) 来的光线被反射到反射方向 \( \omega_r \) 的比率。它是一个比值，通常作为以下等式的一部分：
$$
L_r(\omega_r) = \int_{\text{hemisphere}} L_i(\omega_i) f_r(\omega_i, \omega_r) (\omega_i \cdot n) d\omega_i
$$

其中：

- \( L_r(\omega_r) \) 是从方向 \( \omega_r \) 看到的反射光亮度。
- \( L_i(\omega_i) \) 是从方向 \( \omega_i \) 来的入射光亮度。
- \( n \) 是表面的法向。
- \( \omega_i \cdot n \) 是入射光方向和法线之间的点积，表示光线与表面的夹角的余弦值。

### 特点

- **双向性**：BRDF是双向的，这意味着它考虑了入射光和反射光的方向。
- **依赖性**：BRDF依赖于材料的性质，不同的材料有不同的BRDF。
- **能量守恒**：物理上可行的BRDF必须满足能量守恒的原则，即不会反射比入射到表面上的光更多的光能。
- **局部与非局部**：有些BRDF只考虑局部的光照（如Lambertian反射），而有些可能包括复杂的光照效果，如光的次表面散射。

### 应用

BRDF在计算机图形学中被广泛用于渲染，尤其是在基于物理的渲染（Physically Based Rendering, PBR）中，它能够帮助模拟材料的真实世界属性，如金属、塑料、木材和布料的表面。通过使用BRDF，艺术家和工程师可以创造出更加逼真的虚拟场景和物体。


## 蒙特卡罗尔积分
## PRT
https://blog.csdn.net/u010281174/article/details/107297385
https://huailiang.github.io/blog/2019/harmonics/ 球谐光照

## 球谐光照
https://huailiang.github.io/blog/2019/harmonics/

使用球谐光照的一个典型例子是在一个3D场景中渲染一个物体，使其接受来自环境的间接光照。这里，我将概述球谐光照的使用步骤，并以渲染一个简单物体为例。

### 步骤 1: 捕捉环境光照

首先，我们需要捕捉环境光照。这通常是通过环境贴图来完成的，如使用HDR全景图。该贴图捕捉了环境中所有方向上的光照。

### 步骤 2: 计算球谐系数

然后，我们需要从环境贴图中计算球谐系数。这通常通过对贴图上的像素进行积分来完成，使用球谐基函数作为权重。这个过程通常是预计算的，可以使用一些图形库或者渲染引擎中的工具来完成。

### 步骤 3: 使用球谐系数渲染物体

在实时渲染中，我们会使用预计算的球谐系数来近似计算物体表面每一点的光照。通常，这涉及到将球谐系数与物体表面的法线方向相关的球谐基函数进行点乘，从而得到该点的光照颜色和强度。

### 例子：渲染一个球体

假设我们要在一个游戏引擎中渲染一个球体，并且我们已经有了表示环境光的球谐系数。这些系数是通过对环境中的光照分布进行球谐投影得到的。

在渲染循环中，我们需要做以下事情：

1. 对于球体上的每一个顶点，我们首先计算该点的法线向量 \( \vec{N} \)。
2. 然后，我们使用这个法线向量和预计算的球谐系数来计算顶点的光照颜色。这通常涉及到将法线向量与球谐基函数相关联，并将结果与球谐系数相乘。
3. 计算出的光照颜色随后用于着色该顶点。

假设我们有9个球谐系数（对应于三阶球谐函数），我们可以将它们与球体的法线 \( \vec{N} \) 进行点乘，以获得最终的漫反射光照颜色 \( \vec{L} \)：

$$
\vec{L} = \sum_{i=0}^{8} c_i \cdot Y_i(\vec{N})
$$

其中 \( c_i \) 是预计算的球谐系数，\( Y_i \) 是与法线方向相关的球谐基函数，它们可以是实数球谐函数。

球谐光照的一个关键优点是，对于静态环境，系数只需要计算一次，然后即可用于渲染场景中的所有物体，大大提高了效率。
### 为什么要将球谐系数与法线点乘
在使用球谐光照时，球谐系数与法线的点乘并不直接产生颜色。实际上，这个点乘是球谐光照近似计算的一部分，它用于确定每个方向上的光照强度。这个计算的结果是一个标量值，它与环境光照的颜色相乘后给出了该方向上的光照颜色贡献。

球谐光照的关键在于使用球谐系数来近似一个场景中的光照分布。这些系数是环境光照在球谐基函数上的投影，可以看作是环境光照的低频（或平滑）表示。在实时渲染中，我们通常使用第一阶或第二阶球谐函数，这提供了9个（对于第二阶）或更少的系数来近似全向光照。

当我们渲染一个表面点时，我们使用该点的法线 \( \vec{N} \) 与每个球谐系数相乘。这个操作实质上是在使用法线方向来“采样”球谐光照函数。因为球谐函数是定义在球面上的，所以每个函数都与一个特定的方向相关联。法线向量指向的方向允许我们计算出在该特定方向上光照的近似强度。

最终的颜色计算通常如下：

1. 对于环境光照的每个颜色通道（通常是红、绿、蓝），我们有一组球谐系数。
2. 我们使用表面法线与这些系数进行点乘，为每个颜色通道计算出一个标量值。
3. 这些标量值分别与环境光照的颜色通道相乘，得到了该方向上的光照颜色贡献。

所以，尽管点乘操作本身不生成颜色，但它是计算每个方向上光照强度的关键步骤，这个强度随后用于确定物体在环境光照下的颜色。
## PBR

## 常见的三个光照模型Lambert，Phong，BlinnPhong

https://zhuanlan.zhihu.com/p/144331612
### Lambert
https://www.cnblogs.com/jerrycg/p/4941359.html